

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>WebSubmit Admin Guide &mdash; tind-doc 1.0.0 documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  
    <link rel="top" title="tind-doc 1.0.0 documentation" href="../index.html"/>
        <link rel="up" title="Guide for Librarian" href="index.html"/>
        <link rel="next" title="Guide for tool.tind.io" href="../tools/index.html"/>
        <link rel="prev" title="Creation of Collections" href="create-collection.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        <a href="../index.html" class="fa fa-home"> tind-doc</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
        
            <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Guide for Librarian</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="create-collection.html">Creation of Collections</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="">WebSubmit Admin Guide</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tools/index.html">Guide for tool.tind.io</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../tools/index.html#overview">1. Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tools/index.html#make-documents-restricted">2. Make documents restricted</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tools/index.html#link-records">3. Link records</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../doc/index.html">Documentation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../doc/intro.html">MARC intro</a></li>
<li class="toctree-l2"><a class="reference internal" href="../doc/use-of-marc.html">MARC Fields</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../howto/index.html">How to create documentation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../howto/docguide.html">Blablabla</a></li>
</ul>
</li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Guide for Librarian</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="create-collection.html">Creation of Collections</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="">WebSubmit Admin Guide</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tools/index.html">Guide for tool.tind.io</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../tools/index.html#overview">1. Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tools/index.html#make-documents-restricted">2. Make documents restricted</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tools/index.html#link-records">3. Link records</a></li>
</ul>
</li>
</ul>
<ul class="simple">
</ul>

        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">tind-doc</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
          <li><a href="index.html">Guide for Librarian</a> &raquo;</li>
      
    <li>WebSubmit Admin Guide</li>
      <li class="wy-breadcrumbs-aside">
        
          <a href="../_sources/admin/websubmit-admin-guide.txt" rel="nofollow"> View page source</a>
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            
  <div class="section" id="websubmit-admin-guide">
<span id="id1"></span><h1>WebSubmit Admin Guide<a class="headerlink" href="#websubmit-admin-guide" title="Permalink to this headline">¶</a></h1>
<p><em>Disclaimer:</em> Though this guide provides all the necessary information
to start learning WebSubmit from scratch and reach a good level in
administrating it, this guide is not yet fully complete, and might
contain information that has not been strictly verified (sample codes
are for eg. provided &#8220;AS IS&#8221;, only to offer some guidance to the admin).</p>
<p>Specific topics would benefit from to being more developed, such as HOW-TOs,
sample workflows (for eg. approval workflows and referee management). At
this point the demo submissions that come standard with the Atlantis
demo site remain essential companions to this guide.</p>
<p><strong>Contributions are welcome (for eg. sample workflows, function
descriptions, etc.)</strong></p>
<div class="section" id="contents">
<h2>Contents<a class="headerlink" href="#contents" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><strong>1. `Overview &lt;#shortIntro&gt;`__</strong><ul>
<li>1.1  <a class="reference external" href="#philosophy">How WebSubmit works</a></li>
<li>1.2  <a class="reference external" href="#behindthescenes">Behind the scenes</a></li>
</ul>
</li>
<li><strong>2. `Configure Submissions: a Tutorial &lt;#2&gt;`__</strong><ul>
<li>2.1  <a class="reference external" href="#2.1">Creating the submission</a></li>
<li>2.2  <a class="reference external" href="#2.2">Building the interface</a></li>
<li>2.3  <a class="reference external" href="#2.3">Adding the functions</a></li>
<li>2.4  <a class="reference external" href="#2.4">Restricting the submission</a></li>
</ul>
</li>
<li><strong>3. `WebSubmit Elements &lt;#3&gt;`__</strong><ul>
<li>3.1  <a class="reference external" href="#3.1">Existing elements</a></li>
<li>3.2  <a class="reference external" href="#3.2">Creating a new element</a></li>
<li>3.3  <a class="reference external" href="#3.3">Creating a new check</a></li>
</ul>
</li>
<li><strong>4. `WebSubmit Functions &lt;#4&gt;`__</strong><ul>
<li>4.1  <a class="reference external" href="#4.1">Existing functions</a></li>
<li>4.2  <a class="reference external" href="#4.2">Creating a new function</a></li>
</ul>
</li>
<li><strong>5. `File Management with WebSubmit &lt;#5&gt;`__</strong><ul>
<li>5.1  <a class="reference external" href="#5.1">**Option 1:** File Input element + FFT</a></li>
<li>5.2  <a class="reference external" href="#5.2">**Option 2:** File Input element +
Move_Files_To_Storage function</a></li>
<li>5.3  <a class="reference external" href="#5.3">**Option 3:** Create_Upload_Files_Interface +
Move_Uploaded_Files_To_Storage functions</a></li>
<li>5.4  <a class="reference external" href="#5.4">**Option 4:** Upload_File element instance +
Move_Uploaded_Files_To_Storage function</a></li>
<li>5.5  <a class="reference external" href="#5.5">**Option 5:** FCKeditor element instance +
Move_FCKeditor_Files_To_Storage function</a></li>
<li>5.6  <a class="reference external" href="#5.6">**Option 6:** Upload_Photo_interface element instance +
Move_Photos_To_Storage function</a></li>
<li>5.7  <a class="reference external" href="#5.7">Alternatives to WebSubmit: BibDocFile CLI or BibDocFile
Web Interface</a></li>
</ul>
</li>
<li><strong>6. `Access restrictions &lt;#6&gt;`__</strong><ul>
<li>6.1  <a class="reference external" href="#6.1">Admin-level</a></li>
<li>6.2  <a class="reference external" href="#6.2">User-level</a></li>
</ul>
</li>
<li><strong>7. `Linking to submissions &lt;#linking&gt;`__</strong><ul>
<li>7.1  <a class="reference external" href="#linkingfromsubmissions">Adding a link from the submissions
page</a></li>
<li>7.2  <a class="reference external" href="#linkingwithurl">Linking to a submission with direct URL (in email,
formats, etc.)</a></li>
</ul>
</li>
<li><strong>8. `Terminology &lt;#terminology&gt;`__</strong><ul>
<li>8.1  <cite>8.1 The document type of a file
(``doctype`</cite>) &lt;#terminologydocumenttype&gt;`__</li>
<li>8.2  <cite>8.2 The submission directory
(``curdir`</cite>) &lt;#terminologycurdir&gt;`__</li>
</ul>
</li>
<li><strong>9. `Load/dump Submissions &lt;#load_dump_cli&gt;`__</strong></li>
</ul>
<p>(Check out the <a class="reference external" href="#oldwebsubmitguide">old WebSubmit admin guide</a>)</p>
</div>
<div class="section" id="overview">
<h2>1. Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<div class="section" id="how-websubmit-works">
<h3>1.1 How WebSubmit Works<a class="headerlink" href="#how-websubmit-works" title="Permalink to this headline">¶</a></h3>
<p>WebSubmit provides the infrastructure to set up customized pages for
your users to submit new metadata and files to your repository. It is
highly flexible in order to accomodate to the various type of documents
that you might need to archive. As a consequence of this flexibility, it
requires a good level of understanding of the concepts behind WebSubmit.</p>
<p>A simplied schema of a typical WebSubmit workflow is the following one
(figure 1): one or several pages are presented to the user to enter some
information, such as title of the document, authors, etc. Each of these
pages contain a form with one or several <a class="reference external" href="#3">WebSubmit elements</a>,
which can either display some information to the user, or ask for input
from the user. <a class="reference external" href="#3">WebSubmit elements</a> are described more in
detailed further below. After the user has finished filling the forms on
all pages, a series of <a class="reference external" href="#4">WebSubmit functions</a> are called. These
functions will typically (1) post-process the data, (2) create a
MARCXML, (3) upload the created MARCXML file, and (4) send confirmation
email(s).</p>
<p><a href="#id43"><span class="problematic" id="id44">|image0|</span></a> Figure 1</p>
<p>One thing worth learning from this simple workflow is that (1) functions
are executed one after each other, (2) that each function can have side
effects, such as sending email, and that (3) the output of these
functions is displayed to the user. Typical submissions use many
side-effect functions, and only one function that give some feedback to
the user (in the form of a web page). Also most submissions usually need
only a single page.</p>
<p>Finally, note that you can plug a check for each field of a page, so that
the user cannot proceed further if some invalid text has been entered.</p>
<p><a href="#id45"><span class="problematic" id="id46">|image1|</span></a> Figure 2</p>
<p>Functions are also organized in steps (Figure 2). By default, WebSubmit
runs the &#8220;step 1 block&#8221; and then stops: to run the next steps one must
have a function at the end of step 1 that jump to another block (for eg.
CaseEDS function) or have a WebSubmit element that set the input form
&#8220;step&#8221; to the value of the block number (such as
&#8220;<tt class="docutils literal"><span class="pre">Create_Modify_Interface</span></tt>&#8221; function).</p>
<p><a href="#id47"><span class="problematic" id="id48">|image2|</span></a> Figure 3</p>
<p>A set of WebSubmit functions comes installed by default in Invenio, to
provide all the necessary functionality to create your own workflow.
The behaviour of these functions can be customized through their
parameters. Advanced users can also create their own functions in Python
(see further below in this guide). The main difficulty for beginners is
to pick the adequate function and carefully choose their ordering. It is
recommended to get inspiration from the sample demo submission at first.</p>
<p>At this point it is particularly important to understand that the
WebSubmit engine s more or less limited to 1) displaying page to collect
data, and 2) run functions. It does not take care of building a record
and inserting it into a collection, but expects to have a set of
functions configured to do so.</p>
<p>Such a multi-page submission could appear to users as shown in figure 4.
Note that this figure shows a special page <em>0</em>. This &#8220;cover&#8221; page is
mandatory for all submissions, and is automatically generated by
WebSubmit. It can be customized to 1) display a description of the
submission, 2) show the available &#8220;actions&#8221; (described further below)
and 3) let the users choose among the available &#8220;categories&#8221; (described
further below).</p>
<p><a href="#id49"><span class="problematic" id="id50">|image3|</span></a></p>
<p>→</p>
<p><a href="#id51"><span class="problematic" id="id52">|image4|</span></a></p>
<p>→</p>
<p><a href="#id53"><span class="problematic" id="id54">|image5|</span></a></p>
<p>→</p>
<p><a href="#id55"><span class="problematic" id="id56">|image6|</span></a></p>
<p>Page &#8220;0&#8221;</p>
<p>Page 1</p>
<p>Page 2</p>
<p>Functions ouput</p>
<p>Figure 4</p>
<p>Indeed, typical submissions do not contain only one, but several
independant workflows called &#8220;actions&#8221;: one action might be dedicated to
the submission of a document, while another one will let the user modify
a previously submitted record. Different actions can therefore display
different sets of pages and call different post-processing functions.
The first page of a submission (page &#8220;0&#8221;) will let users chose among the
offered actions.</p>
<p>By convention we use 3-letters names for the actions of a submission.
For example:</p>
<ul class="simple">
<li><strong>SBI</strong>: submit a new record</li>
<li><strong>MBI</strong>: modify the metadata of a record</li>
<li><strong>SRV</strong>: submit a revised file</li>
</ul>
<p><a href="#id57"><span class="problematic" id="id58">|image7|</span></a> Figure 5</p>
<p>Actions are displayed as several buttons (blue by default) for users to
choose from to start a new submission (Figure 6):</p>
<p><a href="#id59"><span class="problematic" id="id60">|image8|</span></a> Figure 6</p>
<p>Figure 6 also shows the possibility to select among various categories
prior to jumping into one of the available actions. These categories
usually don&#8217;t have a direct impact on the chosen workflow. Think of them
simply as a simple WebSubmit element place on the first page, that is
common to all the actions of your submission (indeed you could set up
your submissions to have such categories inside your submission actions
pages, but that would require additional work).</p>
<p>Last, but not least, a submission is usually referred to by a short name
(at most 5 letters), reused in many places in the WebSubmit admin
interface.</p>
<p>To summarize:</p>
<ul class="simple">
<li>A <strong>submission</strong> is made of different actions</li>
<li>An <strong>action</strong> is a workflow made of pages, checks and a flow of
functions.</li>
<li>A <strong>page</strong> contains several WebSubmit elements, usually input
elements with some label.</li>
<li>A <strong>WebSubmit element</strong> is a control on the interface to input or
display values.</li>
<li>Javacript <strong>checks</strong> can be attached to WebSubmit elements, in order
to validate the input data before going to a futher step of the
submission.</li>
<li>A <strong>function</strong> performs some post-processing operations, usually on
data collected thanks to WebSubmit elements. Functions can have
side-effects and outputs</li>
<li>Functions are organized in <strong>steps</strong>, blocks of functions</li>
</ul>
<p>Another concept remains to be explained, but this functionality tends
to disappear from submissions, and might be deprecated at some point. We
provide the explanation about it below only for completeness, but it is
strongly discouraged to go that way:</p>
<p>It is possible to group actions in <strong>sets</strong>: an action set is a
succession of actions which should be done in a given order when a
user starts.</p>
<p>For example the submission of a document can be composed of two
actions: Submission of Bibliographic Information (SBI) and Fulltext
Transfer (FTT) which should be done one after the other.
When the user starts the submission, we want the submission to get
him first in SBI and when he finishes SBI to carry him to FTT. SBI
and FTT are in this case in the same action set. They will both have
a level of 1 (&#8220;level&#8221; is a bad name, it should be &#8220;action set
number&#8221;), SBI will have a score of 1, and FTT a score of 2 (which
means it will be started after SBI). If you set the stpage of FTT to
2, the user will be directly carried to the 2nd page of the FTT web
form. This value is usually set to 1.
The endtxt field contains the text which will be displayed to the
user at the end of the first action (here it could be &#8220;you now have
to transfer your files&#8221;)
A single action like &#8220;Modify Bibliographic Information&#8221; should have
the 3 columns to 0,0 and 1.</p>
</div>
<div class="section" id="behind-the-scenes">
<h3>1.2 Behind the scenes<a class="headerlink" href="#behind-the-scenes" title="Permalink to this headline">¶</a></h3>
<p>This section highlights a few key behaviours of WebSubmit which are
particularly important to understand when designing a submission.</p>
<p>When a user starts a new submission, a working directory is created on
disk in order to store all the collected values. This working directory
is usually called the &#8220;<tt class="docutils literal"><span class="pre">curdir</span></tt>&#8221;. It is located in a subdirectory of
<tt class="docutils literal"><span class="pre">/opt/invenio/var/data/submit/storage/</span></tt><em>{action
directory}</em><tt class="docutils literal"><span class="pre">/</span></tt><em>{submission code}</em><tt class="docutils literal"><span class="pre">/</span></tt><em>{submission access
number}</em> where <em>{submission code}</em> is the short name of a submission and
<em>{submission access number}</em> is a unique submission session identifier
(displayed on the web submission interface as the <em>submission
number</em>).<em>{action directory}</em> is <tt class="docutils literal"><span class="pre">running</span></tt> for SBI actions,
<tt class="docutils literal"><span class="pre">modify</span></tt> for &#8220;MBI&#8221; actions, <tt class="docutils literal"><span class="pre">revise</span></tt> for &#8220;SRV&#8221; actions, etc. (This
is configured in the &#8220;Actions&#8221; part of the WebSubmit admin interface)</p>
<p>Whenever the user moves from one page to the other, or submit the
form, the curdir is populated with files named after the submission
elements displayed on the page, with their content being the user
inserted values (User uploaded files can be found by default in the
<tt class="docutils literal"><span class="pre">curdir/files/</span></tt> directory). It is these files that WebSubmit functions
such &#8220;<tt class="docutils literal"><span class="pre">Create_Record</span></tt>&#8221; or &#8220;<tt class="docutils literal"><span class="pre">Modify_Record</span></tt>&#8221; will use in order to
create the MARCXML to upload (Note that the output of these functions
will be a file named &#8220;<tt class="docutils literal"><span class="pre">recmysql</span></tt>&#8221; in the <tt class="docutils literal"><span class="pre">curdir</span></tt>, that will
contain the MARCXML to upload)</p>
<p>The curdir contains a few other additional files:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">function_log</span></tt>: the list of functions called by the WebSubmit
engines</li>
<li><tt class="docutils literal"><span class="pre">SuE</span></tt>: the email of the submitter</li>
<li><tt class="docutils literal"><span class="pre">doctype</span></tt>: the short name (code name) of the current submission</li>
<li><tt class="docutils literal"><span class="pre">act</span></tt>: the current action (SBI, MBI, etc.)</li>
<li><tt class="docutils literal"><span class="pre">step</span></tt>: the step of the functions</li>
<li><tt class="docutils literal"><span class="pre">curpage</span></tt>: the current page of the submission</li>
<li><tt class="docutils literal"><span class="pre">ln</span></tt>: the language chosen by the user to display the web interface</li>
<li><tt class="docutils literal"><span class="pre">combo</span></tt><em>{doctype}</em>: for eg. <tt class="docutils literal"><span class="pre">comboDEMOART</span></tt> contains the chosen
category on page &#8220;0&#8221;.</li>
<li>etc.</li>
</ul>
<p>The path to the <tt class="docutils literal"><span class="pre">curdir</span></tt> can sometimes be slightly different,
depending on the chosen action. For eg. the SRV action will use
<tt class="docutils literal"><span class="pre">/opt/invenio/var/data/submit/storage/revise/</span></tt><em>{submission
code}</em><tt class="docutils literal"><span class="pre">/</span></tt><em>{submission access number}</em> where <em>{submission code}</em></p>
<p>When the functions will run they will most probably create additional
files, such as &#8220;<tt class="docutils literal"><span class="pre">SN</span></tt>&#8221; created by the &#8220;<tt class="docutils literal"><span class="pre">Create_Recid</span></tt>&#8221; function
which reserves a record id, &#8220;<tt class="docutils literal"><span class="pre">RN</span></tt>&#8221; created by function
&#8220;<tt class="docutils literal"><span class="pre">Report_Number_Generation</span></tt>&#8221; to reserve a report number, or the
&#8220;<tt class="docutils literal"><span class="pre">recmysql</span></tt>&#8221; file already mentionned above. Many of these output
file then become input parameters for the next functions to be executed.
This shows the importance of running a well defined set of functions in
a well defined order.</p>
<p>The <tt class="docutils literal"><span class="pre">curdir</span></tt> is not removed after the end of the submission. This
gives you the opportunity to keep track of past submissions in case
something would have gone unexpected. However the use of the
&#8220;<tt class="docutils literal"><span class="pre">Move_to_Done</span></tt>&#8221; function will create a zipped archive of this
directory (+ rename it using the report number of the record, found in
file <tt class="docutils literal"><span class="pre">curdir/RN</span></tt>), and will move it to a different directory,
<tt class="docutils literal"><span class="pre">/opt/invenio/var/data/submit/storage/done/running/</span></tt>.</p>
</div>
</div>
<div class="section" id="configure-submissions-a-tutorial">
<h2>2. Configure Submissions: a Tutorial<a class="headerlink" href="#configure-submissions-a-tutorial" title="Permalink to this headline">¶</a></h2>
<p>This chapter is a quick walkthrough for creating your submission. It is
not trying to explain everything, but simply goes through the main steps
necessary to configure a submission.</p>
<div class="section" id="creating-the-submission">
<h3>2.1 Creating the submission<a class="headerlink" href="#creating-the-submission" title="Permalink to this headline">¶</a></h3>
<p><strong>1.</strong> Go to the <a class="reference external" href="/admin/websubmit/websubmitadmin.py">WebSubmit admin
interface</a>
and click on the &#8220;Add New Doctype&#8221; button at the bottom of the screen.
Give your submission an ID (eg. <tt class="docutils literal"><span class="pre">DEMOTEST</span></tt>. This cannot be changed
later and should be kept short. It is used in URLs to link to your
submission), a name and a description. The name and the description will
be displayed on the users end. The description can contain HTML markup.
You can also choose to clone from an already existing submission so that
existing configuration for pages, functions, elements, etc. are copied
over to your new submission (this might be not wanted if the submission
you copy from include submission specific elements).</p>
<p><strong>2.</strong> From the submission page, select from the &#8220;Add a new Submission&#8221;
menu the action to add to your newly created submission. For eg. select
&#8220;[SBI] Submit New Record&#8221; to create an action that will allow users to
submit new documents. Press the &#8220;Add Submission&#8221; button to add the
chosen action. You are given the possibility to clone the configuration
from another existing submission. Start with a blank one or choose an
existing one, then press &#8220;Continue&#8221;.</p>
<p><strong>3.</strong> On the following page, fill in the form:</p>
<ul class="simple">
<li>Choose if the action is to be displayed on the start page of your
submission.</li>
<li></li>
<li>Enter the &#8220;<tt class="docutils literal"><span class="pre">Status</span> <span class="pre">Text</span></tt>&#8221;: not really used in user interface (<em>to
be checked</em>): label for your action in the WebSubmit admin interface.</li>
<li>Other fields are related to action sets (<em>chained actions</em>). It is
recommended to leave the default values.<ul>
<li>Input the &#8220;<tt class="docutils literal"><span class="pre">End</span> <span class="pre">text</span></tt>&#8221;: text displayed at the end of the
previous action to link to this one, provided that this action is
chained to another (leaving empty is recommended).</li>
<li>Choose the &#8220;<tt class="docutils literal"><span class="pre">Stpage</span></tt>&#8221;: the page number that should be used as
starting point when reaching this action from another chained
action: leaving &#8216;0&#8217; is recommended).</li>
<li>The &#8220;<tt class="docutils literal"><span class="pre">level</span></tt>&#8221;: the group of actions to which this one belongs,
in case it is chained with another action(s) (leaving emtpy is
recommended).</li>
<li>The &#8220;<tt class="docutils literal"><span class="pre">score</span></tt>&#8221;: the order in which grouped actions are chained
(leaving empty is recommended).</li>
</ul>
</li>
</ul>
<p>Once done, press the &#8220;Save Details&#8221; button.</p>
<p><strong>4.</strong> (Optional) Repeat steps 2 and 3 for any other workflow you want
to support in your submission. If the action you want to add is not part
of the list, click on the <a class="reference external" href="/admin/websubmit/websubmitadmin.py/actionlist">available
actions</a>
menu, press the &#8220;Add Action&#8221; button and enter the &#8220;<tt class="docutils literal"><span class="pre">action</span> <span class="pre">code</span></tt>&#8221;
(for eg. <tt class="docutils literal"><span class="pre">SBI</span></tt>), &#8220;<tt class="docutils literal"><span class="pre">description</span></tt>&#8221; (displayed as the page title when
going through the submission pages), &#8220;<tt class="docutils literal"><span class="pre">dir</span></tt>&#8221; (in which subdirectory
of the default base submission folder the running/done submissions for
this action will be saved, for eg. <tt class="docutils literal"><span class="pre">submit</span></tt>), and &#8220;<tt class="docutils literal"><span class="pre">status</span> <span class="pre">text</span></tt>&#8221;
(displayed as the label for the action button on the main submission
interface). Press Save Details, and you are ready to use this action.</p>
<p><strong>5.</strong> (Optional) To propose a list of categories on the splash page
(page 0) of your submission, select your submission from the main
<a class="reference external" href="/admin/websubmit/websubmitadmin.py">WebSubmit admin
interface</a>,
scroll down to the &#8220;Categories&#8221; section on the page, enter a new
category, with &#8220;<tt class="docutils literal"><span class="pre">ID</span></tt>&#8221; being the key code of the new category you
want to add (this value will be saved in the corresponding file in
<tt class="docutils literal"><span class="pre">curdir</span></tt> directory of your submission. Reminder: the file in
<tt class="docutils literal"><span class="pre">curdir</span></tt> containing this value will be named <tt class="docutils literal"><span class="pre">comboDEMOTEST</span></tt>,
provided that &#8220;<tt class="docutils literal"><span class="pre">DEMOTEST</span></tt>&#8221; is your submission ID) and
&#8220;<tt class="docutils literal"><span class="pre">description</span></tt>&#8221; being the value displayed to the user for this
category. Press &#8220;<tt class="docutils literal"><span class="pre">Add</span> <span class="pre">Category</span></tt>&#8221; to add the category.</p>
<p><strong>6.</strong> (Optional) To enter the list of persons that will be recognized
as referees of a submission (for eg. by the &#8220;<tt class="docutils literal"><span class="pre">Is_Referee</span></tt>&#8221;
function), select your submission from the main <a class="reference external" href="/admin/websubmit/websubmitadmin.py">WebSubmit admin
interface</a>,
scroll down to the &#8220;Manage Referees&#8221; section on the page, and click on
the &#8220;Manage Referees&#8221; button.</p>
<p>Select the user(s) from the list (users must have an account on the
system), choose which category they manage, and click &#8220;Add&#8221;. Once done,
click &#8220;Finished&#8221;.</p>
<p><strong>7.</strong> The skeleton of your submission is now basically ready. You will
need to add new pages to it, as well as insert post-processing
functions. These steps are defined in the next sections. What you can do
now is to make the submission visible on the main <a class="reference external" href="/submit">submissions users
page</a>. To do so, click on the <a class="reference external" href="/admin/websubmit/websubmitadmin.py/organisesubmissionpage">Organise
Main
Page</a>
of the main menu, select your submission in the &#8220;Document Type Name&#8221;
menu, choose from the next menu to which branch of the submission tree
you want to attach this submission, and press &#8220;Add&#8221;. Reorganize the tree
as wanted from this interface.</p>
</div>
<div class="section" id="building-the-interface">
<h3>2.2 Building the interface<a class="headerlink" href="#building-the-interface" title="Permalink to this headline">¶</a></h3>
<p><strong>1.</strong> Go to the main <a class="reference external" href="/admin/websubmit/websubmitadmin.py">WebSubmit admin
interface</a>
and select your submission. Choose the action (SBI, MBI, etc.) for which
you want to build the interface and click on the corresponding &#8220;view
interface&#8221; link.</p>
<p><strong>2.</strong> If you want to add a new page, click on the &#8220;Add a Page&#8221; button.
Follow the &#8220;view page&#8221; link displayed next to the newly created page, or
the one next to the page you want to modify.</p>
<p><strong>3.</strong> To add a new field on the page, press the &#8220;Add a Field&#8221; button
(at the bottom of the screen). On the following page:</p>
<ul class="simple">
<li>Select a field from the existing list of WebSubmit elements.</li>
<li>Enter a field label. It will be displayed just before the field on
your page. The label can contain HTML. Note that this label will not
be used in modification actions (MBI) built using the
&#8220;<tt class="docutils literal"><span class="pre">Create_Modify_Interface</span></tt>&#8221; function. Instead, the &#8220;Modification
Text&#8221; attribute of the element will be used.</li>
<li>Set if the field should be mandatory or not. Note that some elements
(<a class="reference external" href="#3.2.1">User Defined Input Elements</a>, <a class="reference external" href="#3.2.5">Hidden Input
Elements</a> and <a class="reference external" href="#3.2.5">Response Elements</a>) should never
be set &#8220;mandatory&#8221;.</li>
<li>Give a short description to the label. It will be used for eg. to
notify the user that mandatory field named <em>XXX</em> has not been filled
in.</li>
<li>Select a Javascript check from the list if you want to validate the
content of the field according to some criteria.</li>
</ul>
<p>Once done, hit the &#8220;Add Field&#8221; button.</p>
<p>Note that this step is simply instantiating a WebSubmit element to
include on your page. If you want to include a field that does not exist
in the available elements, you should first create it. Learn more about
the creation of WebSubmit elements in the <a class="reference external" href="#3">*WebSubmit Elements*</a>
chapter of this guide.</p>
<p><strong>4.</strong> Repeat step 3 as many times as needed. You can reorder the
fields on the page, remove them or change their attribute. The &#8220;edit&#8221;
link next to each field will let you change its attributes. The
&#8220;element&#8221; link will however let you change the attribute of the
WebSubmit element itself, i.e. affecting all the submissions having such
a field on their page.</p>
<p><strong>5.</strong> You can preview the page by pressing the &#8220;View Page Preview&#8221;
button at the top of the page. Note that <a class="reference external" href="#3.2.5">Response Elements</a>
will however not be previewed.</p>
<p><strong>6.</strong> From the &#8220;page&#8221; interface you can go back successively to the
action interface and the main submission interface by clicking on the
&#8220;Finished&#8221; buttons at the bottom of the pages.</p>
</div>
<div class="section" id="adding-the-functions">
<h3>2.3 Adding the functions<a class="headerlink" href="#adding-the-functions" title="Permalink to this headline">¶</a></h3>
<p><strong>1.</strong> Go to the main <a class="reference external" href="/admin/websubmit/websubmitadmin.py">WebSubmit admin interface</a>
and select your submission. Choose the action (SBI, MBI, etc.) for which
you want to build the interface and click on the corresponding &#8220;view
functions&#8221; link.</p>
<p><strong>2.</strong> To insert a function into the workflow, press the &#8220;Add a
Function&#8221; button at the bottom of the screen. On the following page:</p>
<ul class="simple">
<li>Select a function from the existing list of WebSubmit functions.</li>
<li>Enter the &#8220;<tt class="docutils literal"><span class="pre">Step</span></tt>&#8221; to which this function should be added (for
eg. &#8220;1&#8221;).</li>
<li>Enter the &#8220;<tt class="docutils literal"><span class="pre">Score</span></tt>&#8221; of the function, i.e. its order in the list
of functions of the chosen step (for eg. 20). If a function already
exists for the chosen score, functions will simply be shifted.</li>
</ul>
<p>Once done, hit the &#8220;Save Details&#8221; button.</p>
<p>Note that this step is simply inserting an already existing WebSubmit
function in your workflow. If you want to include a totally new function
you should first create it. Learn more about the creation of WebSubmit
functions in the <a class="reference external" href="#4">*WebSubmit Functions*</a> chapter of this guide.</p>
<p><strong>3.</strong> Once the function is inserted you can change its parameters by
clicking on the &#8220;View parameters&#8221; link. Each function has a different
set of parameters. Check the function documentation (available from the
<a class="reference external" href="/admin/websubmit/websubmitadmin.py/functionlist">Available
Functions</a>
menu of the WebSubmit admin interface) to learn more about the offered
options.</p>
<p><strong>4.</strong> Repeat steps 2 and 3 as many times as needed. You can reorder the
functions on the page or remove them.</p>
</div>
<div class="section" id="restricting-the-submission">
<h3>2.4 Restricting the submission<a class="headerlink" href="#restricting-the-submission" title="Permalink to this headline">¶</a></h3>
<p>Access to the submission interface is mostly restricted via the
WebAccess module. You can check out the <a class="reference external" href="#6">Access Restrictions</a>
chapter of this guide and refer to the <a class="reference external" href="/help/admin/webaccess-admin-guide">WebAccess
admin</a> guide
for detailed information.</p>
<p>In addition to WebAccess you can use the following functions to restrict
your submission:</p>
<p>If you have set up an action that requires to modify an existing record
(to add file, modify metadata, etc.) you can add the
&#8220;<tt class="docutils literal"><span class="pre">Is_Original_Submitter</span></tt>&#8221; function in order to only let the original
submitter of the record modify the record. This function must be added
at the beginning of your list of functions (usually after the
&#8220;<tt class="docutils literal"><span class="pre">Get_Recid</span></tt>&#8221; function), for <strong>each action</strong>, and <strong>each step</strong>.
Check out the <a class="reference external" href="#2.3">*Adding the functions*</a> section of this guide to
learn how to add this function to your workflow.</p>
<p>You can also use the &#8220;<tt class="docutils literal"><span class="pre">User_is_Record_Owner_or_Curator</span></tt>&#8221; function to
enable access to the original submitter of the record AND users
connected to a specific WebAccess role.</p>
<p>If you have set up an action (for eg. &#8220;APP&#8221;) that requires to approve a
document by a referee (defined in the list of referees for your
submission) you can add the &#8220;<tt class="docutils literal"><span class="pre">Is_Referee</span></tt>&#8221; function in order to only
let the referee go through. This function must be added at the beginning
of your list of functions (usually after the &#8220;<tt class="docutils literal"><span class="pre">Get_Recid</span></tt>&#8221;
function), for <strong>each action</strong>, and <strong>each step</strong>. Check out the
<a class="reference external" href="#2.3">*Adding the functions*</a> section of this guide to learn how to
add this function to your workflow.</p>
</div>
</div>
<div class="section" id="websubmit-elements">
<h2>3. WebSubmit Elements<a class="headerlink" href="#websubmit-elements" title="Permalink to this headline">¶</a></h2>
<p>WebSubmit elements are the building blocks of submission pages. This
section focuses on how to use or create them. Refer to the overview of
this guide to learn more about the concept of WebSubmit elements.</p>
<div class="section" id="existing-elements">
<h3>3.1 Existing elements<a class="headerlink" href="#existing-elements" title="Permalink to this headline">¶</a></h3>
<p>The list of existing elements can be found in the <a class="reference external" href="/admin/websubmit/websubmitadmin.py/elementlist">&#8220;available elements&#8221;
section</a>
of the WebSubmit admin interface. By default these elements are
instances used in the demo submissions. You can reuse them, but it is
recommended to create new elements to use in your own submissions,
excepted for complex &#8220;response&#8221; elements that are generic enough.</p>
<p>Once instantiated for a submission, elements become <em>fields</em> on the
submission page. It is important to make a difference between the fields
attributes, which are submission specific, and the element attributes,
which apply to all submission using them.</p>
</div>
<div class="section" id="creating-a-new-element">
<h3>3.2 Creating a new element<a class="headerlink" href="#creating-a-new-element" title="Permalink to this headline">¶</a></h3>
<p>This section describes the creation of a customized element. It does not
show how to add an already existing element to your submission. Refer to
the <a class="reference external" href="#2">Tutorial</a> to learn how to add an existing element to your
submission.</p>
<p>To create a new element, go to the the <a class="reference external" href="/admin/websubmit/websubmitadmin.py/elementlist">&#8220;available elements&#8221;
section</a>
of the WebSubmit admin interface, scroll down to the bottom of the page
and press the &#8220;Add New Element&#8221; button.</p>
<p>Fill in the form:</p>
<ul>
<li><p class="first"><strong>Element Name</strong>: The name of the element (Eg: <tt class="docutils literal"><span class="pre">DEMO_TITLE</span></tt>)</p>
</li>
<li><p class="first"><strong>Modification Text</strong>: The prefix to be used when the element is used
by the &#8220;<tt class="docutils literal"><span class="pre">Create_Modify_Interface</span></tt>&#8221; function (i.e. in MBI actions)</p>
</li>
<li><p class="first"><strong>Element Type</strong>: The type of element:</p>
<ul>
<li><p class="first"><em>User Defined Input</em>: the element is a static area displaying the
content of the field &#8220;Element Description&#8221;. The content must be
HTML-escaped (or can be HTML).</p>
</li>
<li><p class="first"><em>File Input</em>: the element is a basic control to upload files</p>
</li>
<li><p class="first"><em>Hidden Input</em>: the element is an hidden form input field, and its
value is the one defined in the &#8220;Value&#8221; field (below).</p>
</li>
<li><p class="first"><em>Text Input</em>: the element is a simple text field. Initial value is
the one defined in the &#8220;Value&#8221; field.</p>
</li>
<li><p class="first"><em>Response</em>: the element executes the Python code from the &#8220;Element
Description&#8221; field. The code is executed at runtime when
displaying the page. The element output consists in the value
assigned to the variable &#8220;<tt class="docutils literal"><span class="pre">text</span></tt>&#8221; in the scope of this field
at the end of the execution of the element.</p>
</li>
<li><p class="first"><em>Select Box</em>: a list control. The full HTML code of the list must
be given in the &#8220;Element Description&#8221; field. For eg:</p>
<div class="highlight-python"><div class="highlight"><pre>&lt;select name=&quot;DEMO_LANG&quot;&gt;
        &lt;option value=&quot;eng&quot;&gt;English&lt;/option&gt;
        &lt;option value=&quot;fre&quot;&gt;French&lt;/option&gt;
        &lt;option value=&quot;ger&quot;&gt;German&lt;/option&gt;
&lt;/select&gt;
</pre></div>
</div>
<p>The submitted value will be the one defined in the &#8220;<tt class="docutils literal"><span class="pre">value</span></tt>&#8221;
parameter.</p>
</li>
<li><p class="first"><em>Text Area Element</em>: An HTML text area field.</p>
</li>
</ul>
</li>
<li><p class="first"><strong>Marc Code</strong>: the MARC code from which the value could be retrieved
when the element is used by the &#8220;<tt class="docutils literal"><span class="pre">Create_Modify_Interface</span></tt>&#8221;
function (i.e. in MBI actions)</p>
</li>
<li><p class="first"><strong>Size</strong>: The size of the text input field (for &#8220;Text Input&#8221; Element
Types)</p>
</li>
<li><p class="first"><strong>No. Rows</strong>: The number of rows for &#8220;Text Area&#8221; Element Types</p>
</li>
<li><p class="first"><strong>No. Columns</strong>: The number of columns for &#8220;Text Area&#8221; Element Types</p>
</li>
<li><p class="first"><strong>Maximum Length</strong>: The maximum length (in characters) for &#8220;Text
Input&#8221; Element Types. Note that it only sets a limits in the user&#8217;s
browser, but is not check server-side.</p>
</li>
<li><p class="first"><strong>Value</strong>: The initial value for &#8220;Text Input&#8221; or &#8220;Hidden Input&#8221;
elements</p>
</li>
<li><p class="first"><strong>Element Description</strong>: The content/code for &#8220;User Defined Input&#8221;,
&#8220;Select Box&#8221; and &#8220;Response&#8221; elements</p>
</li>
</ul>
<p>Once done, hit the &#8220;Save Details&#8221; button. You are done with the creation
of your element. You can then add it to your submission page.</p>
<p><strong>About element names</strong>: some names are &#8220;reserved&#8221;, and should not be
used as names for elements, as they would overlap with filenames created
internally by WebSubmit in the submission directory (curdir). You can
still use these element names, but should be aware of the potential side
effects of changing such variables with user submitted values. An
up-to-date list of reserved filenames for your installation can be found
by running
<tt class="docutils literal"><span class="pre">python</span> <span class="pre">-c</span> <span class="pre">'from</span> <span class="pre">invenio.legacy.websubmit.config</span> <span class="pre">import</span> <span class="pre">CFG_RESERVED_SUBMISSION_FILENAMES;print</span> <span class="pre">CFG_RESERVED_SUBMISSION_FILENAMES'</span></tt>.</p>
<div class="section" id="user-defined-input-elements">
<h4>3.2.1 User Defined Input Elements<a class="headerlink" href="#user-defined-input-elements" title="Permalink to this headline">¶</a></h4>
<p>This element is simply displaying the the content defined in the field
&#8220;Element Description&#8221;. The content must be HTML-escaped (or can be
HTML). This is element is not really suitable for user-input values.</p>
</div>
<div class="section" id="file-input-elements">
<h4>3.2.2 File Input Elements<a class="headerlink" href="#file-input-elements" title="Permalink to this headline">¶</a></h4>
<p>The element displays a basic control to upload files. The file uploaded
with this element can be found upon submission inside
<tt class="docutils literal"><span class="pre">[..]/files/ELEMENT_NAME/</span></tt> (where <tt class="docutils literal"><span class="pre">ELEMENT_NAME</span></tt> is your element
name, for eg. <tt class="docutils literal"><span class="pre">DEMOART_FILE</span></tt>) within the submission directory.</p>
<p>You can then further process the uploaded file with relevant WebSubmit
functions (eg. stamp the file), and attach it to the record (see
<a class="reference external" href="#5">section 5. *File Management with WebSubmit*</a> of this guide).</p>
</div>
<div class="section" id="hidden-input-elements">
<h4>3.2.3 Hidden Input Elements<a class="headerlink" href="#hidden-input-elements" title="Permalink to this headline">¶</a></h4>
<p>Simply create an hidden input field, with the value defined in the
&#8220;Value&#8221; field of the element. The uploaded value can be found as any
other element in the submission directory upon submission of the form.</p>
<p>The main usage of this field is to upload a statically defined value in
order to check if the form has already been submitted. Static values to
be part of the record would better be defined in the BibConvert
configuration file used to create the record.</p>
</div>
<div class="section" id="text-input-elements">
<h4>3.2.4 Text Input Elements<a class="headerlink" href="#text-input-elements" title="Permalink to this headline">¶</a></h4>
<p>A simple text input field, Nothing much to say about it excepted that it
is usually the most used of all elements.</p>
</div>
<div class="section" id="response-elements">
<h4>3.2.5 Response Elements<a class="headerlink" href="#response-elements" title="Permalink to this headline">¶</a></h4>
<p>Response elements are elements evaluated at runtime, which execute the
Python code they embed. These elements are useful when you need to
display complex controls that are not supported by default by WebSubmit,
or if you need to generate content dynamically. The returned output
(displayed on the submission form) of response elements is the one
defined at the end of the execution in the &#8220;<tt class="docutils literal"><span class="pre">text</span></tt>&#8221; variable.</p>
<p>For eg. to display a radio button one would write:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">text</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
<span class="n">options</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<span class="k">for</span> <span class="n">option</span> <span class="ow">in</span> <span class="n">options</span><span class="p">:</span>
    <span class="n">text</span> <span class="o">+=</span> <span class="s">&#39;&lt;input type=&quot;radio&quot; name=&quot;group1&quot; id=&quot;</span><span class="si">%(opt)i</span><span class="s">&quot; value=&quot;</span><span class="si">%(opt)i</span><span class="s">&quot;&gt;&lt;label for=&quot;</span><span class="si">%(opt)i</span><span class="s">&quot;&gt;Option </span><span class="si">%(opt)i</span><span class="s">&lt;/label&gt;&#39;</span> <span class="o">%</span> <span class="p">{</span><span class="s">&#39;opt&#39;</span><span class="p">:</span> <span class="n">option</span><span class="p">}</span>
</pre></div>
</div>
<p>which would display as::</p>
<div class="highlight-python"><div class="highlight"><pre>Option 1 Option 2 Option 3
</pre></div>
</div>
<p>Upon submission of the form, a file named &#8220;<tt class="docutils literal"><span class="pre">group1</span></tt>&#8221; would be
created in that case with the chosen value in the submission directory.</p>
<p>Response elements have &#8220;magically&#8221; access to some global variables,
provided that they have been set at the moment of executing the element:</p>
<ul class="simple">
<li><strong>``sysno``</strong> the current record id</li>
<li><strong>``rn``</strong> the current report number</li>
<li><strong>``act``</strong> the current submission action (SBI, MBI, etc.)</li>
<li><strong>``curdir``</strong> the path of the current submission directory</li>
<li><strong>``uid``</strong> the user ID of the current submitter</li>
<li><strong>``uid_email``</strong> the email of the current submitter</li>
</ul>
<p>When defining a response element you should be aware of a few traps:</p>
<ul class="simple">
<li>You must expect that the page can be reloaded. In that case possible
actions performed by your element should not be done twice. You also
have to take care of the displayed state of your element. For eg. a
list generated by a response element should not reset to the default
value when the page refreshes if the user has already chosen a custom
value. You take care of this by reading the corresponding file in the
submission directory.</li>
<li>When used in MBI (modify) actions with the
&#8220;<tt class="docutils literal"><span class="pre">Create_Modify_Interface</span></tt>&#8221; function (which takes care of
building the modification form by mirroring the page defined for the
initial submission, SBI), you should read the initial state from the
record (if defined in the record), or from the curdir if the page is
refreshed.</li>
<li>You should never specify a response element as &#8220;mandatory&#8221; when
including it on your page.</li>
</ul>
<p>A possible skeleton for a response element could be: (FIXME: Check...)</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">invenio.legacy.websubmit.functions.ParamFile</span> <span class="kn">import</span> <span class="n">ParamFromFile</span>
<span class="kn">from</span> <span class="nn">invenio.legacy.bibrecord</span> <span class="kn">import</span> <span class="n">get_fieldvalues</span>

<span class="n">this_element_name</span> <span class="o">=</span> <span class="s">&quot;DEMOART_TEST&quot;</span> <span class="c"># This would be your element name</span>

<span class="k">if</span> <span class="n">act</span> <span class="o">==</span> <span class="s">&quot;SBI&quot;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">curdir</span><span class="p">,</span> <span class="n">this_element_name</span><span class="p">)):</span>
    <span class="n">default_value</span> <span class="o">=</span> <span class="s">&quot;A default value&quot;</span> <span class="c"># or any default value</span>
<span class="k">elif</span> <span class="n">act</span> <span class="o">==</span> <span class="s">&quot;MBI&quot;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">curdir</span><span class="p">,</span> <span class="n">this_element_name</span><span class="p">)):</span>
    <span class="n">default_value</span> <span class="o">=</span> <span class="n">get_fieldvalues</span><span class="p">(</span><span class="n">sysno</span><span class="p">,</span> <span class="s">&#39;245__a&#39;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">default_value</span> <span class="o">=</span> <span class="n">ParamFromFile</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">curdir</span><span class="p">,</span> <span class="n">this_element_name</span><span class="p">))</span>

<span class="n">text</span> <span class="o">=</span> <span class="s">&#39;&lt;input type=&quot;text&quot; name=&quot;</span><span class="si">%s</span><span class="s">&quot; value=&quot;</span><span class="si">%s</span><span class="s">&quot;/&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">this_element_name</span><span class="p">,</span> <span class="n">default_value</span><span class="p">)</span>
</pre></div>
</div>
<p>Since response element needs the submission context and can possibly
have side effects, they are never executed when previewing your
submission pages from the WebSubmit admin interface.</p>
<div class="section" id="select-box-elements">
<h5>3.2.6 Select Box Elements<a class="headerlink" href="#select-box-elements" title="Permalink to this headline">¶</a></h5>
<p>Select Box elements are used to display lists menus (either as dropdown
menu or multiple selection list). The element is not smart enough to
save you from specifying the HTML markup of the list, but will at least
set the right intial state when reloading the submission page or when
used in MBI actions.</p>
<p>You would for eg. define the following &#8220;description&#8221; for an element
displaying a list of languages:</p>
<div class="highlight-html"><div class="highlight"><pre><span class="nt">&lt;select</span> <span class="na">name=</span><span class="s">&quot;DEMOART_LANG&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;option&gt;</span>Select:<span class="nt">&lt;/option&gt;</span>
        <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">&quot;eng&quot;</span><span class="nt">&gt;</span>English<span class="nt">&lt;/option&gt;</span>
        <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">&quot;fre&quot;</span><span class="nt">&gt;</span>French<span class="nt">&lt;/option&gt;</span>
        <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">&quot;ger&quot;</span><span class="nt">&gt;</span>German<span class="nt">&lt;/option&gt;</span>
        <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">&quot;dut&quot;</span><span class="nt">&gt;</span>Dutch<span class="nt">&lt;/option&gt;</span>
<span class="nt">&lt;/select&gt;</span>
</pre></div>
</div>
<p>In the above example a file named &#8220;DEMOART_LANG&#8221; will be created with
the user chosen value (for eg. &#8220;ger&#8221;) in the submission directory.</p>
<p>Note that if you set the element as being &#8220;mandatory&#8221; on your page, the
initial &#8220;Select:&#8221; value must be the first option of your list (you can
otherwise let specify the element as optional, and remove this item if
wanted).</p>
</div>
</div>
</div>
<div class="section" id="creating-a-new-check">
<h3>3.3 Creating a new check<a class="headerlink" href="#creating-a-new-check" title="Permalink to this headline">¶</a></h3>
<p>When adding an existing element to your submission page you can
associate a Javacript check to the element. You can choose from the
existing one or define your own check from the <a class="reference external" href="/admin/websubmit/websubmitadmin.py/jschecklist">Available
Checks</a>
menu of the WebSubmit admin interface.</p>
<p>From the &#8220;Available Checks&#8221; page, select &#8220;Add check&#8221;, give it a name and
a &#8220;description&#8221;: the description corresponds to the Javascript code to
be executed to validate the form before submitting it. In this
description you should define a Javascript function named after your
check, that takes a string (the value to validate) as input. The
function must then return <tt class="docutils literal"><span class="pre">0</span></tt> if the check fails (the form cannot be
submitted) or <tt class="docutils literal"><span class="pre">1</span></tt> if the check passes. In addition you may want to
raise an alert notifying the user about the error.</p>
<p>For eg. to check if the given number of a field is smaller than 10, we
create a &#8220;check&#8221; named <tt class="docutils literal"><span class="pre">Smaller_Ten</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">Smaller_Ten</span><span class="p">(</span><span class="n">txt</span><span class="p">)</span> <span class="p">{</span>
    <span class="o">/*</span> <span class="n">Check</span> <span class="k">if</span> <span class="nb">input</span> <span class="ow">is</span> <span class="n">strictly</span> <span class="n">smaller</span> <span class="n">than</span> <span class="mi">10</span> <span class="o">*/</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">parseInt</span><span class="p">(</span><span class="n">txt</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">10</span> <span class="o">&amp;&amp;</span> <span class="n">parseInt</span><span class="p">(</span><span class="n">txt</span><span class="p">)</span><span class="o">.</span><span class="n">toString</span><span class="p">()</span><span class="o">==</span><span class="n">txt</span><span class="p">)</span> <span class="p">{</span>
        <span class="o">//</span> <span class="n">Note</span> <span class="n">that</span> <span class="n">parseInt</span><span class="p">(</span><span class="s">&#39;9a&#39;</span><span class="p">)</span> <span class="n">returns</span> <span class="mi">9</span><span class="p">,</span> <span class="n">hence</span> <span class="n">the</span> <span class="s">&#39;.toString()==txt&#39;</span> <span class="n">test</span><span class="o">.</span>
        <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="n">alert</span><span class="p">(</span><span class="s">&quot;The given number is not smaller than 10! Please fix it.&quot;</span><span class="p">);</span>
        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="websubmit-functions">
<h2>4. WebSubmit Functions<a class="headerlink" href="#websubmit-functions" title="Permalink to this headline">¶</a></h2>
<p>This section focuses on how to create new WebSubmit functions and use
existing ones. To learn more about the concept of WebSubmit functions,
read the <a class="reference external" href="#shortIntro">Overview</a> section of this guide.</p>
<div class="section" id="existing-functions">
<h3>4.1 Existing functions<a class="headerlink" href="#existing-functions" title="Permalink to this headline">¶</a></h3>
<p>The list of existing functions can be found in the <a class="reference external" href="/admin/websubmit/websubmitadmin.py/functionlist">&#8220;available
functions&#8221;
section</a>
of the WebSubmit admin interface. Click on &#8220;Edit Details&#8221; links to read
more about the functions.</p>
<p>You add existing functions in the functions list of each action (SBI,
MBI, etc.) of your submission in order to post-process user-submitted
values and build your customized workflow. Some functions have some
prerequisites on the order they are run, and the functions that must
precede them. For eg. many functions expect the &#8220;<tt class="docutils literal"><span class="pre">Get_Recid</span></tt>&#8221;
function to run before them. You can check the workflows provided with
the Atlantis Demo installation</p>
</div>
<div class="section" id="creating-a-new-function">
<h3>4.2 Creating a new function<a class="headerlink" href="#creating-a-new-function" title="Permalink to this headline">¶</a></h3>
<p>This section describes the creation of a customized function. It does
not show how to add an already existing function to your submission.
Refer to the <a class="reference external" href="#2">Tutorial</a> to learn how to add an existing function
to your submission.</p>
<p>A WebSubmit function corresponds to a Python file, which must be named
after the function name (eg &#8220;<tt class="docutils literal"><span class="pre">My_Function</span></tt>&#8221; =&gt;
&#8220;<tt class="docutils literal"><span class="pre">My_Function.py</span></tt>&#8221;) and placed into the
<tt class="docutils literal"><span class="pre">/opt/invenio/lib/python/invenio/websubmit_functions/</span></tt> directory. The
file must also contain a Python function with the same
&#8220;<tt class="docutils literal"><span class="pre">My_Function</span></tt>&#8221; name. This function interface must be the following
one:</p>
<div class="highlight-python"><div class="highlight"><pre>def My_Function(parameters, curdir, form, user_info=None):
</pre></div>
</div>
<p>where</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">parameters</span></tt>: a dictionary containing the parameters and values
that can be configured in the submission web interface.</li>
<li><tt class="docutils literal"><span class="pre">curdir</span></tt>: the path to the current working directory.</li>
<li><tt class="docutils literal"><span class="pre">form</span></tt>: the form passed to the current web page for possible
reference from inside the function.</li>
<li><tt class="docutils literal"><span class="pre">user_info</span></tt>: the user_info objet reprenting the current user</li>
</ul>
<p>The values returned by the function are printed on the last submission
page.</p>
<p>For the function to be available from the WebSubmit admin interface, it
must be specifically inserted from the <a class="reference external" href="/admin/websubmit/websubmitadmin.py/functionlist">admin
interface</a>.
Scroll down to the bottom of the list, and press &#8220;Add New Function&#8221;.
Insert the function name, as well as all the wished parameters for the
function.</p>
</div>
</div>
<div class="section" id="file-management-with-websubmit">
<h2>5. File Management with WebSubmit<a class="headerlink" href="#file-management-with-websubmit" title="Permalink to this headline">¶</a></h2>
<p>This chapters introduces different strategies to enable file upload in
WebSubmit submissions. You should already have a good understanding of
how WebSubmit works before reading further. Some practice in WebSubmit
submission implementation is also highly recommended in order to
understand the techniques introduced below. To some extent, you might
want to come back to this chapter only once you have already set up your
submission, and are about to implement file support, as the
documentation below is sometimes describing detailed implementation
steps.</p>
<p>Several techniques exists to handle files, to accommodate to various use
cases. Just read further below to choose the most appropriate technique
based on your needs.</p>
<div class="section" id="file-input-fft-technique">
<h3>5.1 File Input + FFT Technique<a class="headerlink" href="#file-input-fft-technique" title="Permalink to this headline">¶</a></h3>
<p>The most &#8220;basic&#8221; way of letting your users submit files is to add a
<em>File Input</em> element to your submission page(s), one for each possible
file to upload, in the same way as you add other input fields.</p>
<p>This technique is useful if you need to handle a well known number of files.</p>
<p><strong>Limitations:</strong></p>
<ul class="simple">
<li>incompatible with function &#8220;<tt class="docutils literal"><span class="pre">Move_to_Done</span></tt>&#8221;, as the path in the
FFT tag would be wrong.</li>
<li>revision of files requires well-defined filenames</li>
<li>cannot easily delete files</li>
<li>cannot easily support file attributes (description, restriction,
name, etc.) modifications</li>
</ul>
<p><strong>Procedure:</strong></p>
<p><strong>1)</strong> You can reuse an already existing <em>File Input</em> element, or create
your own. If you want to reuse an existing one, jump straight to point 3
below. Otherwise, head to the WebSubmit admin interface, select &#8220;6.
Available Elements&#8221; in the menu, scroll down the opening page and hit
&#8220;Add New Element&#8221; button.</p>
<p><strong>2)</strong> Choose a name for your new element (For e.g. &#8220;<tt class="docutils literal"><span class="pre">DEMO_FILE</span></tt>&#8221;).
Select the &#8220;<em>File Input</em>&#8221; item of the &#8220;Element Type&#8221; menu. Once done,
click on the &#8220;Save Detais&#8221; button.</p>
<p><strong>3)</strong> Go to the main WebSubmit admin interface and select the
submission you want to edit (for e.g. &#8220;DEMOART&#8221;), then action (for e.g.
&#8220;SBI&#8221;), then the page. Scroll to the bottom of the page, and click on
the &#8220;Add a Field&#8221; button.</p>
<p><strong>4)</strong> From the &#8220;Field Name&#8221; menu, select the desired input file element
(for e.g. &#8220;<tt class="docutils literal"><span class="pre">DEMO_FILE</span></tt>&#8221;, if you have created it in previous steps).
Fill in the other usual fields, and click &#8220;Add Field&#8221;. Reorder the
elements on the page as needed.</p>
<p>At this step your users will be able to upload a file to the server
during the submission process. Indeed if you have a look at the
corresponding submission directory in
<tt class="docutils literal"><span class="pre">/opt/invenio/var/data/submit/storage/</span></tt> you will see the uploaded file
in the <tt class="docutils literal"><span class="pre">/files/DEMO_FILE/</span></tt> directory, plus a standard <tt class="docutils literal"><span class="pre">DEMO_FILE</span></tt>
file containing the path to the uploaded file. However the file is not
attached to the uploaded record: you must add a corresponding entry in
the BibConvert template, in a similar fashion as you would with other
input fields.</p>
<p><strong>5)</strong> Open your BibConvert &#8220;target&#8221; template used by the
&#8220;<tt class="docutils literal"><span class="pre">Make_Record</span></tt>&#8221; or &#8220;<tt class="docutils literal"><span class="pre">Make_Modify_Record</span></tt>&#8221; in your preferred
editor. If you know where to find your BibConvert templates, jump to
point 6. Otherwise continue reading: the BibConvert templates are used
by the &#8220;<tt class="docutils literal"><span class="pre">Make_Record</span></tt>&#8221; and &#8220;<tt class="docutils literal"><span class="pre">Make_Modify_Record</span></tt>&#8221; to create a
MARCXML according to some specific rules. From your submission page,
click on &#8220;view functions&#8221; of the action you want to edit, then &#8220;view
parameters&#8221; of the <tt class="docutils literal"><span class="pre">Make_Record</span></tt>/<tt class="docutils literal"><span class="pre">Make_Modify_Record</span></tt> function. The
&#8220;create/modifyTemplate&#8221; and &#8220;sourceTemplate&#8221; are the names of the
BibConvert templates you can find in the
<tt class="docutils literal"><span class="pre">/opt/invenio/etc/bibconvert/config/</span></tt> directory (Depending on the
authorization on disk, you might even be able to edit the files from the
web interface). Read more about BibConvert in the <a class="reference external" href="/help/admin/bibconvert-admin-guide">BibConvert admin
guide</a>.</p>
<p><strong>6)</strong> Add an <em>FFT</em> tag to your target BibConvert template. FFT is a
special tag interpreted by BibUpload in order to handle files. You will
find an example below, but you can read more about the FFT syntax in the
<a class="reference external" href="/help/admin/bibupload-admin-guide#3.5">BibUpload admin
guide</a></p>
<div class="highlight-python"><div class="highlight"><pre>FFT::REPL(EOL,)---&lt;datafield tag=&quot;FFT&quot; ind1=&quot; &quot; ind2=&quot; &quot;&gt;&lt;subfield code=&quot;a&quot;&gt;&lt;:curdir::curdir:&gt;/files/DEMO_FILE/&lt;:DEMO_FILE::DEMO_FILE:&gt;&lt;/subfield&gt;&lt;subfield code=&quot;n&quot;&gt;My File&lt;/subfield&gt;&lt;subfield code=&quot;t&quot;&gt;Main&lt;/subfield&gt;&lt;/datafield&gt;
</pre></div>
</div>
<p>The sample line above will rename the uploaded record to &#8220;My File&#8221;, and
then attach it to the record (once the created MARCXML will be
BibUploaded). Note that you could keep the original name, or name the
file after the report number, specify a <tt class="docutils literal"><span class="pre">doctype</span></tt> such as &#8220;Main&#8221;, or
&#8220;additional&#8221;, include a comment specified in another field, etc. Simply
modify the FFT tag according to your needs. Note however that this
technique will allow to revise the file only if you can identify it
later by a well defined name. The above line is also uploading the file
in the category, or <em>doctype</em> &#8220;Main&#8221;</p>
<p><strong>7)</strong> One last thing not to forget is to add <tt class="docutils literal"><span class="pre">DEMO_FILE</span></tt> to the
source BibConvert template, as you would for any other WebSubmit
element. Open the source BibConvert template (which is also given as
parameter to the <tt class="docutils literal"><span class="pre">Make_Record</span></tt>/<tt class="docutils literal"><span class="pre">Make_Modify_Record</span></tt> functions, and
can be found in the <tt class="docutils literal"><span class="pre">/opt/invenio/etc/bibconvert/config/</span></tt> directory),
and add for example:</p>
<div class="highlight-python"><div class="highlight"><pre>DEMO_FILE---&lt;:DEMO_FILE:&gt;
</pre></div>
</div>
<p>Repeat this procedure to add additional input file fields. It is
perfectly ok to have several FFT field instances in the templates.</p>
<p>Note that if one of the <tt class="docutils literal"><span class="pre">file</span> <span class="pre">input</span></tt> fields is left empty by the user,
no file is uploaded, no <tt class="docutils literal"><span class="pre">DEMO_FILE</span></tt> file is created in the submission
directory, but an erroneous FFT line is still inserted in the created
output. It is why you might want to make all the <tt class="docutils literal"><span class="pre">File</span> <span class="pre">Input</span></tt> fields
mandatory, or use the BibConvert <tt class="docutils literal"><span class="pre">MINLW(..)</span></tt> function to ensure that
the field is created only if the output line is at least a given number
of characters (to be computed based on the default length of an empty
line). This shows that this technique reaches its limits quite quickly
in terms of flexibility.</p>
<div class="section" id="revising-deleting-files">
<h4>Revising/deleting files<a class="headerlink" href="#revising-deleting-files" title="Permalink to this headline">¶</a></h4>
<p>To revise files you would create a BibConvert template with the adequate
FFT tag. We assume below that you set up the modification interface by
using the <tt class="docutils literal"><span class="pre">Create_Modify_Interface</span></tt> function/technique, so that we can
reuse the submission page set up for the &#8220;SBI&#8221; action. The key point is
that the <tt class="docutils literal"><span class="pre">Input</span> <span class="pre">File</span></tt> element name is well known (&#8220;<tt class="docutils literal"><span class="pre">DEMO_FILE</span></tt>&#8221; in
our case).</p>
<p><strong>1)</strong> Open your BibConvert &#8220;target&#8221; template used by the
&#8220;<tt class="docutils literal"><span class="pre">Make_Modify_Record</span></tt>&#8221; function. Note that it should not be the same
one as used in the &#8220;SBI&#8221; action of your submission, as it must create
different outputs.</p>
<p><strong>2)</strong> Add an FFT tag to revise your file:</p>
<div class="highlight-python"><div class="highlight"><pre>&lt;datafield tag=&quot;FFT&quot; ind1=&quot; &quot; ind2=&quot; &quot;&gt;
    &lt;subfield code=&quot;a&quot;&gt;&lt;:curdir::curdir:&gt;/files/DEMO_FILE/&lt;:DEMO_FILE::DEMO_FILE:&gt;&lt;/subfield&gt;
&lt;subfield code=&quot;n&quot;&gt;My File&lt;/subfield&gt;
&lt;subfield code=&quot;d&quot;&gt;KEEP-OLD-VALUE&lt;/subfield&gt;
&lt;subfield code=&quot;z&quot;&gt;KEEP-OLD-VALUE&lt;/subfield&gt;
&lt;subfield code=&quot;r&quot;&gt;KEEP-OLD-VALUE&lt;/subfield&gt;
&lt;/datafield&gt;
</pre></div>
</div>
<p><strong>3)</strong> The above FFT will be <em>bibuploaded</em> in <tt class="docutils literal"><span class="pre">--correct</span></tt> mode, hence
revising the file named &#8220;My File&#8221; with the new one. Note in this example
the use of the special keyword <tt class="docutils literal"><span class="pre">KEEP-OLD-VALUE</span></tt> to keep the previous
comment, description or restriction applied to the file, if any (so that
comment is not lost for e.g. if you don&#8217;t ask a new one).</p>
<p>You will notice the following limitation: you must be able to map the
uploaded file to the target file to revise by its name. This means that
you should be able to initially control your filename(s), for e.g. by
having it fixed (&#8220;Main&#8221;, &#8220;additional&#8221;, &#8220;figure&#8221;, etc) or guessable, for
e.g. using the report number
(<tt class="docutils literal"><span class="pre">&lt;:DEMOART_RN::DEMOART_RN:&gt;-main,</span> <span class="pre">&lt;:DEMOART_RN::DEMOART_RN:&gt;-additional</span></tt>).</p>
<p>To circumvent this limitation (as well as the impossibility to delete
files), you might combine this technique with one of the techniques
described below (For eg: with the <tt class="docutils literal"><span class="pre">Move_Revised_Files_To_Storage</span></tt>
function detailed in the <a class="reference external" href="#2.2revise">Revising/deleting files</a>
section of the <a class="reference external" href="#2.2">File Input element + Move_Files_To_Storage
function</a> technique)</p>
</div>
</div>
<div class="section" id="file-input-element-move-files-to-storage-function">
<h3>5.2 File Input element + Move_Files_To_Storage function<a class="headerlink" href="#file-input-element-move-files-to-storage-function" title="Permalink to this headline">¶</a></h3>
<p>This way of doing is similar to the <a class="reference external" href="#2.1">technique described
above</a>. The main difference is that it leaves the job of
actually uploading/revisings the file(s) to a WebSubmit functions,
instead of the FFT in the uploaded MARCXML.</p>
<p><strong>Limitations:</strong></p>
<ul class="simple">
<li>revision of files requires well-defined <tt class="docutils literal"><span class="pre">doctype</span></tt>. The consequence
is that you can have only one file per doctype (1 &#8220;Main&#8221;, 1
&#8220;Additionnal&#8221;, etc.)</li>
<li>cannot easily delete files</li>
<li>does not support setting some additional file attributes
(description, name, etc.)</li>
<li>uploaded doctypes must inherit the names of their <tt class="docutils literal"><span class="pre">File</span> <span class="pre">Input</span></tt>
elements. For eg. &#8220;DEMO_FILE&#8221;, instead of &#8220;Main&#8221;, &#8220;Additional&#8221;,
&#8220;Figure&#8221;, etc.</li>
</ul>
<p><strong>1-4)</strong> Add a file input field to your submission page as describe in
<a class="reference external" href="#2.1">previous technique</a>.</p>
<p>As before, the file is uploaded to the server once the user ends the
submission, but it is not attached to the created record. The solution
is to rely on the &#8220;<tt class="docutils literal"><span class="pre">Move_Files_To_Storage</span></tt>&#8221; function:</p>
<p><strong>5)</strong> Add the &#8220;<tt class="docutils literal"><span class="pre">Move_Files_To_Storage</span></tt>&#8221; function to your submission
functions. It is suggested to insert it after the function
&#8220;Insert_Record&#8221;.</p>
<p><strong>6)</strong> Configure the <tt class="docutils literal"><span class="pre">Move_Files_To_Storage</span></tt> function. The key
parameter is <tt class="docutils literal"><span class="pre">paths_and_suffixes</span></tt>, which must contain your
<tt class="docutils literal"><span class="pre">File</span> <span class="pre">Input</span></tt> element names, and possibly map to some suffixes to be
added to the corresponding uploaded files.</p>
<p>For example, add <tt class="docutils literal"><span class="pre">{'DEMO_FILE':'',</span> <span class="pre">'DEMO_FILE2':'_additional'}</span></tt> to
have the files uploaded with DEMO_FILE and DEMO_FILE2 elements
attached to the record (with the DEMO_FILE2 filename suffixed with
&#8220;_additional&#8221;). The <tt class="docutils literal"><span class="pre">paths_and_restriction</span></tt> works similarly to set
the files restrictions.</p>
<p>Each file is simply attached to the record, with its document type
(<tt class="docutils literal"><span class="pre">doctype</span></tt>) being the name of your input file element (for e.g. file
uploaded with the &#8220;<tt class="docutils literal"><span class="pre">DEMO_FILE</span></tt>&#8221; element is attached with document
type &#8220;<tt class="docutils literal"><span class="pre">DEMO_FILE</span></tt>&#8221;). The filenames are kept.</p>
<div class="section" id="id2">
<h4>Revising/deleting files<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h4>
<p>The &#8220;<tt class="docutils literal"><span class="pre">Move_Revised_Files_To_Storage</span></tt>&#8221; must be added to your
modification workflow (&#8220;MBI&#8221;). It will use the file uploaded with your
&#8220;<tt class="docutils literal"><span class="pre">DEMO_FILE</span></tt>&#8221; input element to revise the file with <tt class="docutils literal"><span class="pre">doctype</span></tt>
&#8220;<tt class="docutils literal"><span class="pre">DEMO_FILE</span></tt>&#8221;, the file from &#8220;<tt class="docutils literal"><span class="pre">DEMO_FILE2</span></tt>&#8221; input element to
revise file with <tt class="docutils literal"><span class="pre">doctype</span></tt> &#8220;<tt class="docutils literal"><span class="pre">DEMO_FILE2</span></tt>&#8221;, etc.</p>
<p><strong>1)</strong> Go to your modification workflow (MBI), and add
<tt class="docutils literal"><span class="pre">Move_Revised_Files_To_Storage</span></tt> to your submission functions (usually
after the &#8220;<tt class="docutils literal"><span class="pre">Insert_Modify_Record</span></tt>&#8221;).</p>
<p><strong>2)</strong> Set up the <tt class="docutils literal"><span class="pre">elementNameToDoctype</span></tt> parameter of this function
so it maps your <tt class="docutils literal"><span class="pre">File</span> <span class="pre">Input</span></tt> field name to the doctype to revise. For
eg: &#8220;<tt class="docutils literal"><span class="pre">DEMO_FILE=Main</span></tt>&#8221; so that file uploaded using the <tt class="docutils literal"><span class="pre">DEMO_FILE</span></tt>
input field will be used to replace the file with <tt class="docutils literal"><span class="pre">doctype</span></tt> &#8220;Main&#8221;.
This makes the assumption that you indeed previously uploaded (for eg.
with an FFT during an SBI step) a file with this doctype.</p>
<p>You can define several mappings, by using character <tt class="docutils literal"><span class="pre">|</span></tt> as
separator. For eg: <tt class="docutils literal"><span class="pre">DEMO_FILE=Main|DEMO_FILE2=Additional</span></tt>.</p>
<p>If you have initially uploaded your files with the
<tt class="docutils literal"><span class="pre">Move_Files_To_Storage</span></tt> function, you will for eg. configure the
parameter with &#8220;<tt class="docutils literal"><span class="pre">DEMO_FILE=DEMO_FILE</span></tt>&#8221;, so that file uploaded with
<tt class="docutils literal"><span class="pre">DEMO_FILE</span></tt> input field will replace the files that have been
previously uploaded with doctype &#8220;DEMO_FILE&#8221;.</p>
<p>Note that function <tt class="docutils literal"><span class="pre">Move_Revised_Files_To_Storage</span></tt> can be used in
combination with other techniques, as long as the mapping in
<tt class="docutils literal"><span class="pre">elementNameToDoctype</span></tt> can be done unambiguously.</p>
<p>Check the <tt class="docutils literal"><span class="pre">Move_Revised_Files_To_Storage</span></tt> function documentation for
more detailed information.</p>
</div>
</div>
<div class="section" id="create-upload-files-interface-move-uploaded-files-to-storage-functions">
<h3>5.3 Create_Upload_Files_Interface + Move_Uploaded_Files_To_Storage functions<a class="headerlink" href="#create-upload-files-interface-move-uploaded-files-to-storage-functions" title="Permalink to this headline">¶</a></h3>
<p>This option offers a full-featured file manager, that can be easily
configured to support file upload, revision, deletion, commenting,
restrictions, etc. It can handle an &#8220;unlimited&#8221; number of files.</p>
<p>The strategy consists in adding a WebSubmit function
(&#8220;<tt class="docutils literal"><span class="pre">Create_Upload_Files_Interface</span></tt>&#8221;) to your submission functions
list, in order to display a file submission interface. The interface
will therefore only show up after all the submission pages have been
filled in and submitted. Once displayed, the interface lets the user
upload new/revised files: the function refreshes the interface for each
upload (runs through the functions list again and stops on the
<tt class="docutils literal"><span class="pre">Create_Upload_Files_Interface</span></tt>). When the user applies the
modifications, the submission &#8220;step&#8221; is incremented and executes the
submissions function of step 2, skipping the display of the interface.
In this step 2 you can perform the usual tasks of your submission. You
also must add an additional function
(<tt class="docutils literal"><span class="pre">Move_Uploaded_Files_To_Storage</span></tt>) to run at step 2 in order to attach
the files that have been submitted at step 1.</p>
<p>These functions are incompatible with function
&#8220;Create_Modify_Interface&#8221;. It is therefore suggested to create a
dedicated submission action (in addition to &#8220;SBI&#8221; and &#8220;MBI&#8221;) to let your
users edit the files independently of the bibliographic data. An example
of such setup can be found in DEMOPIC submission.</p>
<p><strong>Limitations:</strong></p>
<ul class="simple">
<li>Use of a WebSubmit function to draw the interface, which prevents the
interface to be used inside a submission form (is displayed at a
later step). Not as integrated as a simple input file form element.</li>
<li>Requires Javascript to be enabled user-side (is applicable to all
submissions anyway.</li>
</ul>
<p><strong>1)</strong> Go to your submission in WebSubmit admin, and add a new
submission action (for e.g. &#8220;[SRV] Submit New File&#8221;). If necessary,
create your own action in <a class="reference external" href="/admin/websubmit/websubmitadmin.py/actionlist">WebSubmit admin &#8220;Available WebSubmit
Actions&#8221;</a>
page. You can clone from another existing action (in that case move to
point 4 below), or simply create an empty action.</p>
<p><strong>2)</strong> Go to the new SRV action interface (&#8220;View Interface&#8221;), add a
page, open it and add fields that will allow users to specify the record
to update. Typically you will add a &#8220;<tt class="docutils literal"><span class="pre">DEMO_RN</span></tt>&#8221; field to enter the
report number, and &#8220;<tt class="docutils literal"><span class="pre">DEMO_CONTINUE</span></tt>&#8221; button to submit the form.</p>
<p><strong>3)</strong> Go the the new SRV action functions (&#8220;View&#8221; functions) and add
the necessary functions: for e.g. at step 1, &#8220;<tt class="docutils literal"><span class="pre">Get_Report_Number</span></tt>&#8221;,
&#8220;<tt class="docutils literal"><span class="pre">Get_Recid</span></tt>&#8221; and &#8220;<tt class="docutils literal"><span class="pre">Create_Upload_Files_Interface</span></tt>&#8221;. At step 2,
&#8220;<tt class="docutils literal"><span class="pre">Get_Recid</span></tt>&#8221;, &#8220;<tt class="docutils literal"><span class="pre">Move_Uploaded_Files_to_Storage</span></tt>&#8221; and
&#8220;<tt class="docutils literal"><span class="pre">Print_Success</span></tt>&#8221;.</p>
<p><strong>4)</strong> Configure the <tt class="docutils literal"><span class="pre">Create_Upload_Files_Interface</span></tt> parameters. There
are many options available. Briefly, the most important one is the
&#8220;<tt class="docutils literal"><span class="pre">doctype</span></tt>&#8221; parameter, which lets you specify the document types
users are allowed to submit. Use &#8220;<tt class="docutils literal"><span class="pre">|</span></tt>&#8221; to separate doctypes, and
&#8220;<tt class="docutils literal"><span class="pre">=</span></tt>&#8221; to separate <tt class="docutils literal"><span class="pre">doctype</span></tt> and <tt class="docutils literal"><span class="pre">doctype</span></tt> description. For e.g.
input &#8220;<tt class="docutils literal"><span class="pre">Main=Main</span> <span class="pre">File|Additional=Additional</span> <span class="pre">Document</span></tt>&#8221; to let users
choose either Main or Additional types (which will show as &#8220;Main File&#8221;
and &#8220;Additional Document&#8221; to users). Other parameters will let you
define for which <tt class="docutils literal"><span class="pre">doctype</span></tt> users can revise or delete files (for e.g.
specify for <tt class="docutils literal"><span class="pre">canDeleteDoctypes</span></tt> &#8220;Additional&#8221; so that only these
documents can be deleted once they have been uploaded). Use &#8220;<tt class="docutils literal"><span class="pre">*</span></tt>&#8221; to
specify &#8220;any declared doctype&#8221;, and &#8220;<tt class="docutils literal"><span class="pre">|</span></tt>&#8221; as separator (for all
<tt class="docutils literal"><span class="pre">can_*_doctypes</span></tt> parameters).</p>
<p>To read more about the parameters available for this function, check the
<tt class="docutils literal"><span class="pre">`Create_Upload_Files_Interface</span></tt> function
documentation &lt;/admin/websubmit/websubmitadmin.py/functionedit?funcname=Create_Upload_Files_Interface&gt;`__.</p>
<p><strong>5)</strong> Configure the <tt class="docutils literal"><span class="pre">Move_Uploaded_Files_To_Storage</span></tt>. There are less
options than in <tt class="docutils literal"><span class="pre">Create_Upload_Files_Interface</span></tt> function. Specify for
e.g. in <tt class="docutils literal"><span class="pre">createIconDoctypes</span></tt> for which doctypes icons will be created,
or in &#8220;<tt class="docutils literal"><span class="pre">forceFileRevision</span></tt>&#8221; if revisions of file attributes trigger
a new file revision. For an up-to-date documentation check the
<tt class="docutils literal"><span class="pre">`Move_Uploaded_Files_to_Storage</span></tt> function
documentation &lt;/admin/websubmit/websubmitadmin.py/functionedit?funcname=Move_Uploaded_Files_to_Storage&gt;`__.</p>
<div class="section" id="id3">
<h4>Revising/deleting files<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h4>
<p>File revisions and deletions comes for free with the functions. Simply
allow deletion or revision of files when configuring
<tt class="docutils literal"><span class="pre">Create_Upload_Files_Interface</span></tt>.</p>
</div>
</div>
<div class="section" id="upload-file-element-instance-move-uploaded-files-to-storage-function">
<h3>5.4 Upload_File element instance + Move_Uploaded_Files_To_Storage function<a class="headerlink" href="#upload-file-element-instance-move-uploaded-files-to-storage-function" title="Permalink to this headline">¶</a></h3>
<p>This is similar to <a class="reference external" href="#2.3">option 3</a>, except that instead of using a
WebSubmit function to build the interface, you use a regular WebSubmit
response element. The advantage is that you can plug the WebSubmit
element wherever you want on your submission page.</p>
<p><strong>Limitations:</strong></p>
<ul class="simple">
<li>Requires Javascript enabled users-side + support for JQuery library
(most &#8220;recent&#8221; browsers)</li>
</ul>
<p>To set up a file upload interface using this technique:</p>
<p><strong>1)</strong> Go to your submission page, and add an element: choose the
&#8220;<tt class="docutils literal"><span class="pre">Upload_Files</span></tt>&#8221; response element. <strong>But wait!</strong> Read further
before:</p>
<p><strong>2)</strong> You most probably want to customize the upload interface (set
which types of files can be uploaded, how many, etc.). To do so, you
would have to edit the code of the <tt class="docutils literal"><span class="pre">Upload_Files</span></tt> response element and
change the parameters of the &#8220;<tt class="docutils literal"><span class="pre">create_file_upload_interface(..)</span></tt>&#8221;
function. However this would affect all submissions using this element.
The solution is to &#8220;clone&#8221; this element (by creating a new element:
&#8220;Available elements&#8221;-&gt; scroll down -&gt; &#8220;Add New Element&#8221;. Choose for e.g.
name &#8220;<tt class="docutils literal"><span class="pre">DEMO_UploadFiles</span></tt>&#8221;, Element Type-&gt; &#8220;Response&#8221; and paste the
code of the <tt class="docutils literal"><span class="pre">Upload_Files</span></tt> element in the &#8220;Element Description&#8221;
field). Once done, add the &#8220;<tt class="docutils literal"><span class="pre">DEMO_UploadFiles</span></tt>&#8221; element to your
page.</p>
<p><strong>3)</strong> Go to your submission functions. Add the
<tt class="docutils literal"><span class="pre">Move_Uploaded_Files_to_Storage</span></tt> function, and configure it in the
same way as it would be done with the <a class="reference external" href="#2.3">option 3</a>, step 5.</p>
<div class="section" id="id4">
<h4>Revising/deleting files<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h4>
<p>File revisions and deletions comes for free with the this technique.
Simply allow deletion or revision of files when configuring
<tt class="docutils literal"><span class="pre">Upload_Files</span></tt> element of the MBI or SRV steps.</p>
</div>
</div>
<div class="section" id="fckeditor-element-instance-move-fckeditor-files-to-storage-function">
<h3>5.5 FCKeditor element instance + Move_FCKeditor_Files_To_Storage function<a class="headerlink" href="#fckeditor-element-instance-move-fckeditor-files-to-storage-function" title="Permalink to this headline">¶</a></h3>
<p>This technique relies on the popular HTML rich text editor &#8220;FCKeditor&#8221;,
which embeds an interface to upload files. As a consequence it only
makes sense to use this technique in the cases where you want files to
be uploaded as part of some HTML context. Typical use cases are
submissions for the WebJournal module, for which you want to upload
articles. The <tt class="docutils literal"><span class="pre">DEMOJRN</span></tt> submission is an example of submission using
this technique.</p>
<p><strong>Limitations:</strong></p>
<ul class="simple">
<li>Requires Javascript enabled users-side + support for the FCKeditor
(most &#8220;recent&#8221; browsers)</li>
<li>File revisions and deletions are not supported as such (must be done
through other options).</li>
</ul>
<p>Setting up a submission to use the FCKeditor is really similar to the
strategy described in <a class="reference external" href="#2.4">option 4</a>: the principle is to
instantiate a custom &#8220;Response Element&#8221; that will call a function taking
care of the interface, and then plug a WebSubmit function to take care
of attaching the files.</p>
<p><strong>1)</strong> Go to your submission page, and add an element: choose the
&#8220;<tt class="docutils literal"><span class="pre">DEMOJRN_ABSE</span></tt>&#8221; response element. <strong>But wait!</strong> Read further
before:</p>
<p><strong>2)</strong> You will want and need to customize the behaviour of the
FCKeditor, but you don&#8217;t want to alter the behaviour of other
submissions using this element. The solution is to &#8220;clone&#8221; this element:
create a new element: &#8220;Available elements&#8221;-&gt; scroll down -&gt; &#8220;Add New
Element&#8221;. Choose for e.g. name &#8220;<tt class="docutils literal"><span class="pre">DEMO_FCKEDITOR</span></tt>&#8221;, Element Type-&gt;
&#8220;Response&#8221; and paste the code of the <tt class="docutils literal"><span class="pre">DEMOJRN_ABSE</span></tt> element in the
&#8220;Element Description&#8221; field). Customize the element according to your
needs. This will need some development skills and good overview of your
metadata and submission in order to have the editor correctly
initialized. Additional information can be found in the <a class="reference external" href="/help/hacking/fckeditor">FCKeditor
Integration guide</a>.</p>
<p><strong>3)</strong> Once done, add the &#8220;<tt class="docutils literal"><span class="pre">DEMO_FCKEDITOR</span></tt>&#8221; element to your page.</p>
<p><strong>4)</strong> Go to your submission functions. Add the
<tt class="docutils literal"><span class="pre">Move_FCKeditor_Files_To_Storage</span></tt> function, and configure it so that
the <tt class="docutils literal"><span class="pre">input_fields</span></tt> parameter list the name(s) (separated by comma if
several instances) given to the FCKeditor instance(s) created in by the
<tt class="docutils literal"><span class="pre">DEMO_FCKEDITOR</span></tt> response element.</p>
<div class="section" id="id5">
<h4>Revising/deleting files<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h4>
<p>The way this editor is currently used does not let you delete/revise
file right from the editor interface. To set up file deletion/revision,
combine this technique with <a class="reference external" href="#2.3">option 3</a> for example.</p>
</div>
</div>
<div class="section" id="upload-photo-interface-element-instance-move-photos-to-storage-function">
<h3>5.6 Upload_Photo_interface element instance + Move_Photos_To_Storage function<a class="headerlink" href="#upload-photo-interface-element-instance-move-photos-to-storage-function" title="Permalink to this headline">¶</a></h3>
<p>This interface is specifically dedicated to pictures: it enables the
selection of bunch of photos to upload, and let you preview and comment
them before submitting the record.</p>
<p><strong>Limitations:</strong></p>
<ul class="simple">
<li>Requires Javascript enabled users-side + support for the Flash plugin
(version &gt;= 9.0.24)</li>
<li>Support for deletions, but not revisions</li>
</ul>
<p>Setting up a submission to use this interface is really similar to the
strategy described in <a class="reference external" href="#2.4">option 4</a>: the principle is to
instantiate a custom &#8220;Response Element&#8221; that will call a function taking
care of the interface, and then plug a WebSubmit function to take care
of attaching the files.</p>
<p><strong>1)</strong> Go to your submission page, and add an element: choose the
&#8220;<tt class="docutils literal"><span class="pre">Upload_Photos</span></tt>&#8221; response element. <strong>But wait!</strong> Read further
before:</p>
<p><strong>2)</strong>As in other strategies that use a response element to layout the
interface, you might want to customize the behaviour of the photos
uploader, but you don&#8217;t want to alter the behaviour of other submissions
using this element. If so (though it is not needed in the case of this
interface), the solution is to &#8220;clone&#8221; this element: create a new
element: &#8220;Available elements&#8221;-&gt; scroll down -&gt; &#8220;Add New Element&#8221;. Choose
for e.g. name &#8220;<tt class="docutils literal"><span class="pre">DEMO_UPLOADPHOTO</span></tt>&#8221;, Element Type-&gt; &#8220;Response&#8221; and
paste the code of the <tt class="docutils literal"><span class="pre">Upload_Photos</span></tt> element in the &#8220;Element
Description&#8221; field). Customize the element according to your needs. This
will need some development skills in order to have the interface
correctly customized..</p>
<p><strong>3)</strong> Once done, add the &#8220;<tt class="docutils literal"><span class="pre">DEMO_UPLOADPHOTO</span></tt>&#8221; (or <tt class="docutils literal"><span class="pre">Upload_Photos</span></tt>
if you kept the original file) element to your page.</p>
<p><strong>4)</strong> Go to your submission functions. Add the
<tt class="docutils literal"><span class="pre">Move_Photos_To_Storage</span></tt> function, and configure it according to your
needs.</p>
<div class="section" id="id6">
<h4>Revising/deleting files<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h4>
<p>The interface lets user add or remove files, but cannot specifically
revise a file. If needed, it can be combined with another strategy such
as <a class="reference external" href="#2.3">option 3</a>.</p>
</div>
</div>
<div class="section" id="alternatives-bibdocfile-cli-or-bibdocfile-web-interface">
<h3>5.7 Alternatives: BibDocFile CLI or BibDocFile Web Interface<a class="headerlink" href="#alternatives-bibdocfile-cli-or-bibdocfile-web-interface" title="Permalink to this headline">¶</a></h3>
<p>These last techniques are not meant to be used in WebSubmit submissions,
but are admin tools that can be used to manage files, independently of
any submission. They are described here for the sake of completness.</p>
<p>The BibDocFile command line interface is describe in more details in
<a class="reference external" href="/help/admin/howto-fulltext">How to manage your fulltext files through
BibDocFile</a>.</p>
<p>The <a class="reference external" href="/submit/managedocfiles">BibDocFile admin interface</a> gives access
to some of the functionalities offered by its command-line equivalent
through a graphical web interface. Its interface is similar to the one
offered by the <tt class="docutils literal"><span class="pre">Upload_File</span></tt> element or the
<tt class="docutils literal"><span class="pre">Create_Upload_Files_Interface</span></tt> function, but is not tied to a
specific submission (and therefore won&#8217;t automatically execute
post-processing steps such a stamping).</p>
<p>Access to the BibDocFile admin interface is restricted via the
WebAccess <tt class="docutils literal"><span class="pre">runbibdocfile</span></tt> action.</p>
</div>
</div>
<div class="section" id="access-restrictions">
<h2>6. Access restrictions<a class="headerlink" href="#access-restrictions" title="Permalink to this headline">¶</a></h2>
<p>This section focuses on restricting the access to the submission
themselves, not to produce content (records, files, etc.) which are
restricted. Refer to the adequate document to restrict the collections
or files.</p>
<div class="section" id="admin-level">
<h3>6.1 Admin-level<a class="headerlink" href="#admin-level" title="Permalink to this headline">¶</a></h3>
<p>Access to the WebSubmit admin interface is controlled via the WebAccess
<tt class="docutils literal"><span class="pre">cfgwebsubmit</span></tt> action.</p>
</div>
<div class="section" id="user-level">
<h3>6.2 User-level<a class="headerlink" href="#user-level" title="Permalink to this headline">¶</a></h3>
<p>Access to the submissions is controlled via the WebAccess <tt class="docutils literal"><span class="pre">submit</span></tt>
action. The action has the following parameters:</p>
<ul class="simple">
<li><strong>``doctype``</strong>: the submission code (eg. <tt class="docutils literal"><span class="pre">DEMOART</span></tt>) for which you
want to set restrictions.</li>
<li><strong>``act``</strong>: the action (for eg. &#8220;SBI&#8221;) for which you want to set the
restriction. Can be <strong>*</strong> to mean any action for the given
submission.</li>
<li><strong>``categ``</strong>: the category (for eg. &#8220;Article&#8221;, &#8220;Preprint&#8221;) for which
you wan to set the restriction. Can be <strong>*</strong> to mean any category
for the given submission.</li>
</ul>
<p>Connect for eg. a role to the <tt class="docutils literal"><span class="pre">submit</span></tt> action with parameters
<tt class="docutils literal"><span class="pre">doctype=DEMOART,</span> <span class="pre">act=SBI,</span> <span class="pre">categ=*</span></tt> to let people of this role submit
new documents in the <tt class="docutils literal"><span class="pre">DEMOART</span></tt> submission, in any category.</p>
<p><strong>If you do not add an authorization for a given submission doctype and
action (even an empty role), the submission is open to anybody.</strong> For
eg. in the above example, provided that an MBI action exists, even with
a restricted SBI action anybody will be able to modify existing
documents with MBI unless the MBI action is also connected to a role. To
make it short: a submission it not restricted until it is...</p>
<p>Note that it is your responsibility as WebSubmit admin to <strong>ensure that
your workflow is not modifying records outside the desired scope</strong>.
Given that records are independant of the submission that created them,
there is no mechanism in the WebSubmit engine that prevents the DEMOART
submission to modify records created with the DEMOBOOK submission. A
check must be added at the level of WebSubmit functions of your
submission to make sure that chosen submission and category well match
the record to be modified (for eg. retrieved via the
<tt class="docutils literal"><span class="pre">Get_Report_Number</span></tt> function)</p>
<p>.</p>
<p>All the above checks also do not <strong>prevent any authorized user to modify
documents submitted by others</strong>. To enable finer-grained restrictions,
use the WebSubmit function &#8220;<tt class="docutils literal"><span class="pre">Is_Original_Submitter</span></tt>&#8221; or
&#8220;<tt class="docutils literal"><span class="pre">User_is_Record_Owner_or_Curator</span></tt>&#8221; in your MBI, SRV, etc.
submission workflow (for eg. just after the &#8220;Get_Recid&#8221; function).
Check also the <a class="reference external" href="#2.4">Restricting the submission</a> how-to from this
guide.</p>
</div>
</div>
<div class="section" id="linking-to-submissions">
<h2>7. Linking to submissions<a class="headerlink" href="#linking-to-submissions" title="Permalink to this headline">¶</a></h2>
<div class="section" id="adding-a-link-from-the-submissions-page">
<h3>7.1 Adding a link from the submissions page<a class="headerlink" href="#adding-a-link-from-the-submissions-page" title="Permalink to this headline">¶</a></h3>
<p>Please refer to the tutorial (<a class="reference external" href="#2.1.7">section 2.1.7</a>) to learn how
to populate the list of submissions on the main submission page (at
<em>/submit/</em>).</p>
</div>
<div class="section" id="linking-to-a-submission-with-direct-url-in-email-formats-etc">
<h3>7.2 Linking to a submission with direct URL (in email, formats, etc.)<a class="headerlink" href="#linking-to-a-submission-with-direct-url-in-email-formats-etc" title="Permalink to this headline">¶</a></h3>
<p>It might be necessary to construct URL that lead to the submission, for
eg. when sending emails, or when displaying some actions from the
Detailed record view (formats).</p>
<div class="section" id="url-to-main-submission-page">
<h4>7.2.1 URL to main submission page<a class="headerlink" href="#url-to-main-submission-page" title="Permalink to this headline">¶</a></h4>
<p>A url to the main page of a submission can be built with this pattern:</p>
<div class="highlight-python"><div class="highlight"><pre>/submit?doctype=DEMOART
</pre></div>
</div>
<p>where <tt class="docutils literal"><span class="pre">DEMOART</span></tt> would be your submission code.</p>
</div>
<div class="section" id="url-to-jump-straight-into-the-submission">
<h4>7.2.2 URL to jump straight into the submission<a class="headerlink" href="#url-to-jump-straight-into-the-submission" title="Permalink to this headline">¶</a></h4>
<p>One can directly move into the submission by building such a URL:</p>
<div class="highlight-python"><div class="highlight"><pre>/submit/direct?sub={action}(submission_code)
</pre></div>
</div>
<p>For eg: <tt class="docutils literal"><span class="pre">/submit/direct?sub=MBIDEMOART</span></tt></p>
<p>In that way one would skip the submission &#8220;splash&#8221; page (<em>Page &#8220;0&#8221;</em>) and
jump straight to the submission page 1. For an action that must deal
with a specific record (eg. MBI, APP) one can already pre-fill for eg.
the &#8220;report number&#8221; field:</p>
<div class="highlight-python"><div class="highlight"><pre>/submit/direct?sub=MBIDEMOART&amp;DEMOART_RN=TESLA-FEL-99-07
</pre></div>
</div>
<p>Depending on the way your submission is built, you might <strong>have</strong> also
to specify the category of the document to modify (the category is
usually chosen on page &#8220;0&#8221; of the submission):</p>
<div class="highlight-python"><div class="highlight"><pre>/submit/direct?sub=MBIDEMOART&amp;DEMOART_RN=TESLA-FEL-99-07&amp;comboDEMOART=Article
</pre></div>
</div>
<p>(Note how the category field is constructed: <tt class="docutils literal"><span class="pre">combo{submission_code}</span></tt>
)</p>
<p>You can add as many parameters as needed to ensure that the form is
filled with adequate values before being presented to the user. The
parameters names correspond to the fields names in WebSubmit. For eg:</p>
<div class="highlight-python"><div class="highlight"><pre>/submit/direct?sub=MBIDEMOART&amp;DEMOART_RN=TESLA-FEL-99-07&amp;comboDEMOART=Article&amp;DEMOART_CHANGE=DEMOART_TITLE
</pre></div>
</div>
<p>The parameters that you have to specify will depend on the usage which
is made of them on the submission side.</p>
<p>For fields that can take several values as input (for eg. selection
lists, as in the <tt class="docutils literal"><span class="pre">DEMOART_CHANGE</span></tt> example above) and that translate
into a file in the submission direction with one value per line, you
would have to specify all the values in the same URL argument, separated
by <tt class="docutils literal"><span class="pre">&quot;%0A&quot;</span></tt> (newline <tt class="docutils literal"><span class="pre">&quot;\n&quot;</span></tt> encoded for URL):</p>
<div class="highlight-python"><div class="highlight"><pre>/submit/direct?sub=MBIDEMOART&amp;DEMOART_RN=TESLA-FEL-99-07&amp;comboDEMOART=Article&amp;DEMOART_CHANGE=DEMOART_TITLE%0ADEMOART_ABS
</pre></div>
</div>
<p>Depending on how your submission is build, you can also move to another
page (&#8220;<tt class="docutils literal"><span class="pre">curpage</span></tt>&#8221; param) or another step of the
workflow(&#8220;<tt class="docutils literal"><span class="pre">step</span></tt>&#8221; param):</p>
<div class="highlight-python"><div class="highlight"><pre>/submit/direct?sub=MBIDEMOART&amp;DEMOART_RN=TESLA-FEL-99-07&amp;comboDEMOART=Article&amp;DEMOART_CHANGE=DEMOART_TITLE&amp;step=1
</pre></div>
</div>
<p>(In the above example a logged in user would skip the submission splash
page AND the modificaton interface to select the document and fields to
update, to jump directly to the <tt class="docutils literal"><span class="pre">DEMOART_TITLE</span></tt> modification field)</p>
<p>In such cases you have to make sure that you provide all the information
requested by the submission at each of the steps/pages until the
provided step/page. Depending on how your submission is built it might
be simply not possible to do that. This would be especially true when
advancing steps, as functions netween the steps would not be run — most
probably advancing directly to step 1 will be a maximum one can easily
support — while controlling &#8220;<tt class="docutils literal"><span class="pre">curpage</span></tt>&#8221; parameter might be easier.</p>
</div>
</div>
</div>
<div class="section" id="terminology">
<h2>8. Terminology<a class="headerlink" href="#terminology" title="Permalink to this headline">¶</a></h2>
<div class="section" id="the-document-type-of-a-file-doctype">
<h3>8.1 The document type of a file (<tt class="docutils literal"><span class="pre">doctype</span></tt>)<a class="headerlink" href="#the-document-type-of-a-file-doctype" title="Permalink to this headline">¶</a></h3>
<p>The document type is an attribute of a file. It can be seen as a
category which lets you organize your files: &#8220;Main&#8221; file, &#8220;Additional&#8221;,
&#8220;Figures&#8221;, &#8220;source&#8221;, whatever you need. It is not so much used excepted
on <tt class="docutils literal"><span class="pre">record/XXX/files/</span></tt> pages to group files by category. It can
however come handy during file upload processes, to assign different
kinds of restrictions based on the document type, or simply to make the
configuration of the submission easier, depending on which technique you
use to manage files.</p>
</div>
<div class="section" id="the-submission-directory-curdir">
<h3>8.2 The submission directory (<tt class="docutils literal"><span class="pre">curdir</span></tt>)<a class="headerlink" href="#the-submission-directory-curdir" title="Permalink to this headline">¶</a></h3>
<p>The WebSubmit workflow mainly splits in two parts: data gathering (user
interface side, with WebSubmit pages and elements) and data integration
part as a second step (with WebSubmit functions involved, plus
BibConvert templates). In the middle stands the submission directory
(also called &#8220;<tt class="docutils literal"><span class="pre">curdir</span></tt>&#8221;). Each submission session corresponds to a
unique submission directory, which stores the values collected from the
submission pages, in the form of a series of textual files, one for each
input field. These files are named after the submission WebSubmit
elements, and their content is the value input by the submitter. Note
that uploaded files are stored in a <tt class="docutils literal"><span class="pre">/files/</span></tt> subdirectory.</p>
<p>WebSubmit functions process the files in this directory. For example
&#8220;<tt class="docutils literal"><span class="pre">Make_Record</span></tt>&#8221; which creates the MARCXML (through BibConvert
templates), or the <tt class="docutils literal"><span class="pre">Stamp_Uploaded_Files</span></tt>, which will stamp the
uploaded files in the <tt class="docutils literal"><span class="pre">/files/</span></tt> directory. If you happen to write a
customized WebSubmit response element that writes files to disk, or
implement a WebSubmit function that must retrieve submitted values, you
will certainly use the submission directory.</p>
<p>These submission directories are also helpful to debug submissions, and
can act as a backup when something goes wrong during a submission.</p>
<p>An example of submission directory could be found at this path
<tt class="docutils literal"><span class="pre">/opt/invenio/var/data/submit/storage/running/DEMOART/1245135338_62620</span></tt>,
where DEMOART is your submission code, and <tt class="docutils literal"><span class="pre">1245135338_62620</span></tt> is the
submission session ID, as found at the bottom of each WebSubmit web page
during the submission process. Just after the user has finished the
submission, this directory would contain all the collected values of the
form. But the life of the submission directory does not stop there.
Immediately after the user completed the submission, the WebSubmit
functions are executed: for e.g. (depending on how you have configured
your submission) creation of a report number (stored in the submission
directory too!) (Function <tt class="docutils literal"><span class="pre">Report_Number_Generation</span></tt>), creation of the
MARCXML (usually named &#8220;<tt class="docutils literal"><span class="pre">recmysql</span></tt>&#8221;, in the submission directory
again!) (Function <tt class="docutils literal"><span class="pre">Make_Record</span></tt>), upload of the MARCXML (Function
<tt class="docutils literal"><span class="pre">Insert_Record</span></tt>) and <tt class="docutils literal"><span class="pre">Move_To_Done</span></tt>. This last function moves the
submission directory to a new place. It could be for e.g.:
<tt class="docutils literal"><span class="pre">/opt/invenio/var/data/submit/storage/done/DEMOART/DEMO-ARTICLE-2010-001.tar.gz</span></tt>,
supposedly that the report number of the submitted record is
<tt class="docutils literal"><span class="pre">ARTICLE-2010-001</span></tt>. Some other functions will move the submission
directory to other places, and some functions will even let you
configure where to move it.</p>
</div>
</div>
<div class="section" id="load-dump-submissions">
<h2>9. Load/dump Submissions<a class="headerlink" href="#load-dump-submissions" title="Permalink to this headline">¶</a></h2>
<p>Use <tt class="docutils literal"><span class="pre">websubmitadmin</span></tt> to dump a given submission configuration from the
database to a file. For example:</p>
<div class="highlight-python"><div class="highlight"><pre>$ /opt/invenio/bin/websubmitadmin --dump=DEMOART &gt; DEMOART_db_dump.sql
</pre></div>
</div>
<p>The submission dumper tool relies on the fact that submission-specific
elements and functions are prefixed with the submission doctype (for
example <tt class="docutils literal"><span class="pre">DEMOART</span></tt>), and will only dump those. Functions, elements,
etc. without prefix are considered &#8220;shared&#8221;, and not dumped by default,
in order to eliminate duplicates). See also option <tt class="docutils literal"><span class="pre">--method</span></tt> to
change that behaviour.</p>
<p><tt class="docutils literal"><span class="pre">websubmitadmin</span></tt> can also help you &#8220;diff&#8221; between different submission
versions (for eg. between a dump file and the database). This tool will
optionally hide differences solely due to ordering of statements in the
dump, or different modification dates. For example:</p>
<div class="highlight-python"><div class="highlight"><pre>$ /opt/invenio/bin/websubmitadmin --diff=DEMOART --ignore=d,o &lt; DEMOART_db_dump.sql
</pre></div>
</div>
<p>Run <tt class="docutils literal"><span class="pre">/opt/invenio/bin/websubmitadmin</span> <span class="pre">--help</span></tt> for more info and more
examples.</p>
<p>Use <tt class="docutils literal"><span class="pre">dbexec</span></tt> to load a submission dumped with <tt class="docutils literal"><span class="pre">websubmitadmin</span></tt>. For
example:</p>
<div class="highlight-python"><div class="highlight"><pre>$ /opt/invenio/bin/dbexec &lt; DEMOART_db_dump.sql
</pre></div>
</div>
<p><tt class="docutils literal"><span class="pre">-</span> <span class="pre">End</span> <span class="pre">of</span> <span class="pre">new</span> <span class="pre">WebSubmit</span> <span class="pre">admin</span> <span class="pre">guide</span> <span class="pre">-</span></tt></p>
<hr class="docutils" />
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">WARNING: OLD WEBSUBMIT ADMIN GUIDE FOLLOWS</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>This WebSubmit Admin Guide was written for the previous PHP-based
version of the admin tool. The submission concepts and pipeline
description remain valid, but the interface snapshot examples would now
differ. The guide is to be updated soon.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="table-of-contents">
<h2>Table of Contents<a class="headerlink" href="#table-of-contents" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><strong>Introduction</strong><ul>
<li><a class="reference external" href="#introduction">General Overview of the Manager Tool</a></li>
<li><a class="reference external" href="#example">Using the manager through an example</a></li>
<li><a class="reference external" href="#philosophy">Philosophy behind the document submission system</a></li>
</ul>
</li>
<li><strong>The Interface</strong><ul>
<li><a class="reference external" href="#description">Description</a></li>
</ul>
</li>
<li><strong>`Types of Document &lt;#documents&gt;`__</strong><ul>
<li><a class="reference external" href="#documentnew">Add a New Type of Document</a></li>
<li><a class="reference external" href="#documentremove">Remove a type of document</a></li>
<li><a class="reference external" href="#documentmodify">Modify an Existing Type of Document</a></li>
</ul>
</li>
<li><strong>`Actions &lt;#actions&gt;`__</strong><ul>
<li><a class="reference external" href="#actionnew">Add a New Action</a></li>
<li><a class="reference external" href="#actionremove">Remove an Action</a></li>
<li><a class="reference external" href="#actionmodify">Modify an Existing Action</a></li>
<li><a class="reference external" href="#actionimplement">Implement an Action over a Document Type</a><ul>
<li><a class="reference external" href="#implementwebform">Create and Maintain the Web Form</a></li>
<li><a class="reference external" href="#implementfunctions">Create and Maintain the Data
Treatment</a></li>
</ul>
</li>
</ul>
</li>
<li><strong>`Functions &lt;#functions&gt;`__</strong><ul>
<li><a class="reference external" href="#functionnew">Create a New Function</a></li>
<li><a class="reference external" href="#functiondelete">Remove a Function</a></li>
<li><a class="reference external" href="#functionedit">Edit a Function</a></li>
<li><a class="reference external" href="#functiondescription">All Functions Explained</a></li>
</ul>
</li>
<li><strong>`Protection &lt;#protection&gt;`__</strong></li>
<li><strong>`Catalogues Organisation &lt;#catalogues&gt;`__</strong></li>
<li><strong>`BibConvert &lt;#bibconvert&gt;`__</strong></li>
<li><strong>Notes</strong></li>
<li><strong>`FAQ &lt;#faq&gt;`__</strong></li>
</ul>
</div>
<div class="section" id="general-overview-of-the-manager-tool">
<h2>General Overview of the Manager Tool<a class="headerlink" href="#general-overview-of-the-manager-tool" title="Permalink to this headline">¶</a></h2>
<div class="section" id="things-to-know-before-using-the-manager">
<h3>Things to know before using the Manager:<a class="headerlink" href="#things-to-know-before-using-the-manager" title="Permalink to this headline">¶</a></h3>
<p>This manager tool allows you to administrate all the WebSubmit
interface. With it, you will be able to create new actions, new
types of documents and edit the existing ones.</p>
<p>The main objects in webSubmit are the &#8220;action&#8221; (such as &#8220;Submit
New Record&#8221;, &#8220;Submit New File&#8221;, &#8220;Modify Record&#8221;...) and the &#8220;type of
document&#8221; (such as &#8220;preprint&#8221;, &#8220;photo&#8221;...).</p>
<p>To one given type of document can be attached several actions.
An action is the addition of two processes:</p>
<ul class="simple">
<li>The first one is the <a class="reference external" href="#implementwebform">data gathering</a>. The
manager will allow you to create new web forms corresponding to
the fields the user will have to fill in when using webSubmit.</li>
<li>The second one is the <a class="reference external" href="#implementfunctions">data treatement</a>.
Basically, what the program will do with the data gathered during
the first phase. The treatment appears in this tool as a sequence
of functions. This manager will allow you to add functions to an
action, edit the existing functions, and reorder the functions.</li>
</ul>
</div>
<div class="section" id="see-also">
<h3>See also:<a class="headerlink" href="#see-also" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><a class="reference external" href="#example">using the manager through an example</a>
<a class="reference external" href="#description">interface description</a>
<a class="reference external" href="#actions">actions</a>
<a class="reference external" href="#documents">document types</a></div></blockquote>
</div>
</div>
<div class="section" id="using-the-manager-through-an-example">
<h2>Using the manager through an example<a class="headerlink" href="#using-the-manager-through-an-example" title="Permalink to this headline">¶</a></h2>
<div class="section" id="what-is-this">
<h3>what is this?<a class="headerlink" href="#what-is-this" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="the-user-reaches-websubmit-main-page">
<h3>The user reaches WebSubmit main page.<a class="headerlink" href="#the-user-reaches-websubmit-main-page" title="Permalink to this headline">¶</a></h3>
<p><a href="#id61"><span class="problematic" id="id62">|main_menu|</span></a>  To add a document type to WebSubmit, you should go to the
<a class="reference external" href="/admin/websubmit/index.php">main page</a> and
click on &#8220;New Doctype&#8221; in the left blue panel.</p>
<p>Even once created, a document type will not appear automatically on
this page. To configure the list of catalogues and document types
displayed on this page, the administrator shall go to the <a class="reference external" href="/admin/websubmit/editCatalogues.php">edit
catalogues</a>
page. (see the <a class="reference external" href="#catalogues">guide section</a>)</p>
</div>
<div class="section" id="the-user-can-then-click-on-the-document-type-he-is-interested-in">
<h3>The user can then click on the document type he is interested in.<a class="headerlink" href="#the-user-can-then-click-on-the-document-type-he-is-interested-in" title="Permalink to this headline">¶</a></h3>
<p><a href="#id63"><span class="problematic" id="id64">|menu_doc|</span></a>  The text appearing under the header containing
the name of the document can be configured by going to the <a class="reference external" href="websubmit-admin">main
page</a>, click on the title of the document type then
on the &#8220;Edit Document Types Details&#8221; button.</p>
<p>You can associate several categories to a document type which can be
defined by going to the <a class="reference external" href="websubmit-admin">main page</a>, click on the
title of the document type then on the &#8220;View Categories&#8221; button. The
selected category will be saved in a file named &#8220;comboXXX&#8221; (where XXX is
the short name of the document type) in the submission directory.</p>
<p>To add an action button to this page, first implement this action by
going to the <a class="reference external" href="websubmit-admin">main page</a>, click on the title of the
document type then on the &#8220;Add a new submission&#8221; button. If the action
is already implemented and the button still does not appear on the
submision page, then you should edit the details of this implementation:
go to the <a class="reference external" href="websubmit-admin">main page</a>, click on the title of the
document type then on the icon in the &#8220;Edit Submission&#8221; column and in
the line of the desired action. There you should set the &#8220;Displayed&#8221;
form field to &#8220;YES&#8221;.</p>
<p>You can also change the order of the buttons, by going to the <a class="reference external" href="websubmit-admin">main
page</a>, click on the title of the document type then
on the icon in the &#8220;Edit Submission&#8221; column and in the line of the
desired action. There you can set the &#8220;buttonorder&#8221; form field.</p>
<p>The user now may choose a category, then click on the action button he wishes.</p>
</div>
<div class="section" id="the-submission-starts-the-first-page-of-the-web-form-appears">
<h3>The submission starts, the first page of the web form appears.<a class="headerlink" href="#the-submission-starts-the-first-page-of-the-web-form-appears" title="Permalink to this headline">¶</a></h3>
<p><a href="#id65"><span class="problematic" id="id66">|form|</span></a>  This web form is composed of several pages, on
each of these pages form fields can be found. To modify the number of
pages, add or withdraw form fields and modify the texts before each form
field, you shall go to the <a class="reference external" href="websubmit-admin">main page</a>, click on the
title of the document type then on the icon in the &#8220;Edit Submission
Pages&#8221; column and in the line of the desired action. (see the <a class="reference external" href="#actionimplement">guide
section</a>)</p>
</div>
<div class="section" id="on-the-last-page-of-the-submission-there-should-be-a-button-like-in-the-following-image-which-will-trigger-the-end-script">
<h3>On the last page of the submission, there should be a button like in the following image which will trigger the end script<a class="headerlink" href="#on-the-last-page-of-the-submission-there-should-be-a-button-like-in-the-following-image-which-will-trigger-the-end-script" title="Permalink to this headline">¶</a></h3>
<p><a href="#id67"><span class="problematic" id="id68">|end_action|</span></a>  This button is defined like any other form
field. Its definition should include a <em>onclick=&#8221;finish();&#8221;</em> javascript
attribute.</p>
<p>After clicking this button, WebSubmit will apply the end script
functions to the gathered data. To modify the end script, you shall go
to the <a class="reference external" href="websubmit-admin">main page</a>, click on the title of the
document type then on the icon in the &#8220;Edit Functions&#8221; column and in the
line of the desired action. (see the <a class="reference external" href="#implementfunctions">guide
section</a>)</p>
</div>
<div class="section" id="id7">
<h3>See also:<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><a class="reference external" href="#description">interface description</a></li>
<li><a class="reference external" href="#actions">actions</a></li>
<li><a class="reference external" href="#documents">document types</a></li>
</ul>
</div>
</div>
<div class="section" id="philosophy-behind-the-document-submission-system">
<h2>Philosophy behind the document submission system<a class="headerlink" href="#philosophy-behind-the-document-submission-system" title="Permalink to this headline">¶</a></h2>
<p>This page will explain some philosophical issues behind the document
submission system.</p>
<div class="section" id="on-the-relation-between-a-search-collection-and-a-submission-doctype">
<h3>On the relation between a search collection and a submission doctype:<a class="headerlink" href="#on-the-relation-between-a-search-collection-and-a-submission-doctype" title="Permalink to this headline">¶</a></h3>
</div>
</div>
<div class="section" id="interface-description">
<h2>Interface Description<a class="headerlink" href="#interface-description" title="Permalink to this headline">¶</a></h2>
<div class="section" id="welcome-to-websubmit-management-tool">
<h3>Welcome to webSubmit Management tool:<a class="headerlink" href="#welcome-to-websubmit-management-tool" title="Permalink to this headline">¶</a></h3>
<p>on the websubmit admin <a class="reference external" href="websubmit-admin">main page</a> you will find:
<a href="#id69"><span class="problematic" id="id70">|image13|</span></a></p>
<ul class="simple">
<li>The list of all existing document type in the middle of the page.
Click on one line in the list to have access to the main document
modification panel</li>
<li>The right menu panel with the following links inside:<ul>
<li>&#8220;<strong>webSubmit Admin</strong>&#8221;: This links leads you back to the main
page of the manager.</li>
<li>&#8220;<strong>New Doctype</strong>&#8221;: Click here if you wish to create a new
document type.</li>
<li>&#8220;<strong>Remove Doctype</strong>&#8221;: Click here if you want to remove an
existing document type.</li>
<li>&#8220;<strong>Available Actions</strong>&#8221;: Lists all existing actions</li>
<li>&#8220;<strong>Available Javascript Checks</strong>&#8221;: Lists all existing
Javascript checking functions.</li>
<li>&#8220;<strong>Available Element Description</strong>&#8221;: Lists all existing html
form element descriptions.</li>
<li>&#8220;<strong>Available Functions</strong>&#8221;: Lists all existing functions in
CDS Submit.</li>
<li>&#8220;<strong>Organise Main Page</strong>&#8221;: Allows you to manage the
appearance and order of the list of document types on CDS
Submit User main page.</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="id8">
<h3>See also:<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><a class="reference external" href="#description">interface description</a></li>
<li><a class="reference external" href="#actions">actions</a></li>
<li><a class="reference external" href="#documents">document types</a></li>
</ul>
</div>
</div>
<div class="section" id="document-types">
<h2>Document Types<a class="headerlink" href="#document-types" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id9">
<h3>See also:<a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><a class="reference external" href="#documentnew">add a new type of document</a></li>
<li><a class="reference external" href="#documentremove">remove a type of document</a></li>
<li><a class="reference external" href="#documentmodify">modify a type of document</a></li>
<li><a class="reference external" href="#actionimplement">implement an action over a type of document</a></li>
</ul>
</div>
</div>
<div class="section" id="ading-new-type-of-document">
<h2>Ading new type of document<a class="headerlink" href="#ading-new-type-of-document" title="Permalink to this headline">¶</a></h2>
<div class="section" id="how-to-get-there">
<h3>How to get there?<a class="headerlink" href="#how-to-get-there" title="Permalink to this headline">¶</a></h3>
<p>Click on the &#8220;New Doctype&#8221; link in the webSubmit right menu.</p>
</div>
<div class="section" id="how-to-do-this">
<h3>How to do this?<a class="headerlink" href="#how-to-do-this" title="Permalink to this headline">¶</a></h3>
<p>A new document type is defined by 6 fields:</p>
<ul class="simple">
<li><strong>Creation Date</strong> and <strong>Modification Dates</strong> are generated and
modified automatically.</li>
<li><strong>Document Type ID</strong>: This is the acronym for your new document
type. We usually use a 3 letters acronym.</li>
<li><strong>Document Type Name</strong>: This is the full name of your new
document. This is the text which will appear on the list of
available documents and catalogues on webSubmit main page.</li>
<li><strong>Document Type Description</strong>: This is the text which will appear
on the document type submission page. This can be pure text or
html.</li>
<li><strong>Doctype to clone</strong>: Here you can choose to create your document
type as a clone of another existing document type. If so, the new
document type will implement all actions implemented by the
chosen one. The web forms will be the same, and the functions
also, as well as the values of the parameters for these
functions. Of course once cloned, you will be able to modify the
implemented actions.</li>
</ul>
</div>
<div class="section" id="id10">
<h3>See also:<a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><a class="reference external" href="#documentremove">remove a type of document</a></li>
<li><a class="reference external" href="#documentmodify">modify a type of document</a></li>
<li><a class="reference external" href="#actionimplement">implement an action over a type of document</a></li>
</ul>
</div>
</div>
<div class="section" id="removing-a-document-type">
<h2>Removing a Document Type<a class="headerlink" href="#removing-a-document-type" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id11">
<h3>How to get there?<a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h3>
<p>Click on the &#8220;Remove Doctype&#8221; link in the webSubmit admin right menu.</p>
</div>
<div class="section" id="id12">
<h3>How to do this?<a class="headerlink" href="#id12" title="Permalink to this headline">¶</a></h3>
<p>Select the document type to delete then click on the &#8220;Remove
Doctype&#8221; button. Remember by doing this, you will delete this
document type as well as all the implementation of actions for this
document type!</p>
</div>
<div class="section" id="id13">
<h3>See also:<a class="headerlink" href="#id13" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><a class="reference external" href="#documentnew">create a type of document</a></li>
<li><a class="reference external" href="#documentmodify">modify a type of document</a></li>
<li><a class="reference external" href="#actionimplement">implement an action over a type of document</a></li>
</ul>
</div>
</div>
<div class="section" id="modifying-a-document-type">
<h2>Modifying a Document Type<a class="headerlink" href="#modifying-a-document-type" title="Permalink to this headline">¶</a></h2>
<div class="section" id="what-is-it">
<h3>What is it?<a class="headerlink" href="#what-is-it" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><blockquote>
<div>Modifying a document type in webSubmit - this will modify its</div></blockquote>
<p>general data description, not the implementations of the actions on
this document type. For the later, please see <a class="reference external" href="#actionimplement">implement an action
over a type of document</a>.</p>
</div></blockquote>
</div>
<div class="section" id="id14">
<h3>How to get there?<a class="headerlink" href="#id14" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><blockquote>
<div>From the main page of the manager, click on the title of the</div></blockquote>
<p>document type you want to modify, then click on the &#8220;Edit Document
Type Details&#8221;.</p>
</div></blockquote>
</div>
<div class="section" id="id15">
<h3>How to do this?<a class="headerlink" href="#id15" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><blockquote>
<div>Once here, you can modify 2 fields:</div></blockquote>
<p><strong>Document Type Name</strong>: This is the full name of your new document.
This is the text which will appear on the list of available
documents and catalogues on webSubmit main page.
<strong>Document Type Description</strong>: This is the text which will appear on
the right of the screen when the user moves the mouse over the
document type title and on the document type submission page. This
can be pure text or html.</p>
</div></blockquote>
</div>
<div class="section" id="id16">
<h3>See also:<a class="headerlink" href="#id16" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><a class="reference external" href="#documentremove">remove a type of document</a></li>
<li><a class="reference external" href="#documentnew">create a type of document</a></li>
<li><a class="reference external" href="#actionimplement">implement an action over a type of document</a></li>
</ul>
</div>
</div>
<div class="section" id="actions">
<h2>Actions<a class="headerlink" href="#actions" title="Permalink to this headline">¶</a></h2>
<p>In webSubmit you can create several actions (for example &#8220;Submit
New Record&#8221;, &#8220;Submit a New File&#8221;, &#8220;Send to a Distribution List&#8221;,
etc. in fact any action you can imagine to perform on a document
stored in your database). The creation of an action is very simple
and consists in filling in a name, description and associating a
directory to this action. The directory parameter indicates where
the collected data will be stored when the action is carried on.</p>
<p>Once an action is created, you have to implement it over a
document type. Implementing an action means defining the web form
which will be displayed to a user, and defining the treatment (set
of functions) applied to the data which have been gathered. The
implementation of the same action over two document types can be
very different. The fields in the web form can be different as well
as the functions applied at the end of this action.</p>
<div class="section" id="id17">
<h3>See also:<a class="headerlink" href="#id17" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><a class="reference external" href="#actionnew">create a new action</a></li>
<li><a class="reference external" href="#actionremove">remove an action</a></li>
<li><a class="reference external" href="#actionmodify">modify an action</a></li>
<li><a class="reference external" href="#actionimplement">implement an action over a type of document</a></li>
</ul>
</div>
</div>
<div class="section" id="adding-a-new-action">
<h2>Adding a New Action<a class="headerlink" href="#adding-a-new-action" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id18">
<h3>How to get there?<a class="headerlink" href="#id18" title="Permalink to this headline">¶</a></h3>
<p>Click on the &#8220;Available Actions&#8221; link in the websubmit right menu,
then on the &#8220;Add an Action&#8221; button.</p>
</div>
<div class="section" id="id19">
<h3>How to do this?<a class="headerlink" href="#id19" title="Permalink to this headline">¶</a></h3>
<p>A new action is defined by 6 fields:</p>
<ul class="simple">
<li><strong>Creation Date</strong> and <strong>Modification Dates</strong> are generated and
modified automatically.</li>
<li><strong>Action Code</strong>: This is the acronym for your new action. We
usually use a 3 letters acronym.</li>
<li><strong>Action Description</strong>: This is a short description of the new
action.</li>
<li><strong>dir</strong>: This is the name of the directory in which the
submission data will be stored temporarily. If the dir value is
&#8220;running&#8221; as for the &#8220;Submit New Record&#8221; action (SBI), then the
submission data for a Text Document (document acronym &#8220;TEXT&#8221;)
will be stored in the
/opt/invenio/var/data/submit/storage/running/TEXT/9089760_90540
directory (where 9089760_90540 is what we call the submission
number. It is a string automatically generated at the beginning
of each submission). Once finished, the submission data will be
moved to the
/opt/invenio/var/data/submit/storage/done/running/TEXT/ directory
by the &#8220;Move_to_Done&#8221; function.</li>
<li><strong>statustext</strong>: text displayed in the status bar of the browser
when the user moves his mouse upon the action button.</li>
</ul>
</div>
<div class="section" id="id20">
<h3>See also:<a class="headerlink" href="#id20" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><a class="reference external" href="#actionremove">remove an action</a></li>
<li><a class="reference external" href="#actionmodify">modify an action</a></li>
<li><a class="reference external" href="#actionimplement">implement an action over a type of document</a></li>
</ul>
</div>
</div>
<div class="section" id="removing-an-action">
<h2>Removing an Action<a class="headerlink" href="#removing-an-action" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id21">
<h3>What is it?<a class="headerlink" href="#id21" title="Permalink to this headline">¶</a></h3>
<p>Removing the implementation of an action over a document type -
Please note the removal of the action itself is not allowed with
this tool.</p>
</div>
<div class="section" id="id22">
<h3>How to get there?<a class="headerlink" href="#id22" title="Permalink to this headline">¶</a></h3>
<p>From the websubmit admin main page, click on the title of the
relevant document type. Then click on the red cross corresponding to
the line of the action you want to remove.</p>
</div>
<div class="section" id="id23">
<h3>See also:<a class="headerlink" href="#id23" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><a class="reference external" href="#actionnew">create an action</a></li>
<li><a class="reference external" href="#actionmodify">modify an action</a></li>
<li><a class="reference external" href="#actionimplement">implement an action over a type of document</a></li>
</ul>
</div>
</div>
<div class="section" id="modifying-an-action">
<h2>Modifying an Action<a class="headerlink" href="#modifying-an-action" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id24">
<h3>What is it?<a class="headerlink" href="#id24" title="Permalink to this headline">¶</a></h3>
<p>This page is about how to modify the general data about an action -
for modifying the implementation of an action over a document type,
see <a class="reference external" href="#actionimplement">implement an action over a type of document</a></p>
</div>
<div class="section" id="id25">
<h3>How to get there?<a class="headerlink" href="#id25" title="Permalink to this headline">¶</a></h3>
<p>Click on the &#8220;View Actions&#8221; link in the right menu of the websubmit
admin, then on the title of the action you want to modify...</p>
</div>
<div class="section" id="id26">
<h3>How to do this?<a class="headerlink" href="#id26" title="Permalink to this headline">¶</a></h3>
<p>You may modify 3 fields:</p>
<ul class="simple">
<li><strong>Action Description</strong>: This is a short description of the new
action.</li>
<li><strong>dir</strong>: This is the name of the directory in which the
submission data will be stored temporarily. See the meaning of
this parameter in <a class="reference external" href="#actionnew">create an action</a>.</li>
<li><strong>statustext</strong>: text displayed in the status bar of the browser
when the user moves his mouse upon the action button.</li>
</ul>
</div>
<div class="section" id="id27">
<h3>See also:<a class="headerlink" href="#id27" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><a class="reference external" href="#actionremove">remove an action</a></li>
<li><a class="reference external" href="#actionnew">create an action</a></li>
<li><a class="reference external" href="#actionimplement">implement an action over a type of document</a></li>
</ul>
</div>
</div>
<div class="section" id="implement-an-action-over-a-document-type">
<h2>Implement an action over a document type<a class="headerlink" href="#implement-an-action-over-a-document-type" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id28">
<h3>What is it?<a class="headerlink" href="#id28" title="Permalink to this headline">¶</a></h3>
<p>Implement an action over a document type. Create the web forms and
the treatment process.</p>
</div>
<div class="section" id="id29">
<h3>How to get there?<a class="headerlink" href="#id29" title="Permalink to this headline">¶</a></h3>
<p>From the main page of the manager, click on the title of the
relevant document type. Then click on the &#8220;Add a New Submission&#8221; button.</p>
</div>
<div class="section" id="id30">
<h3>How to do this?<a class="headerlink" href="#id30" title="Permalink to this headline">¶</a></h3>
<p>Just select the name of the action you want to implement. When
you select an action, the list of document which already implement
this action appears. Then you can select from this list the document
from which you want to clone the implementation, or just choose &#8220;No
Clone&#8221; if you want to build this implementation from scratch.</p>
<p>After selecting the correct fields, click on the &#8220;Add
Submission&#8221; button.</p>
<p>You then go back to the document type manager page where you can
see that in the bottom array your newly implemented action appears
(check the acronym in the first column).
<a href="#id71"><span class="problematic" id="id72">|image14|</span></a></p>
<ul class="simple">
<li>Clicking on the action acronym will allow you to modify the general
data about the action (remember in this case that all the other
implementations of this particular action will also be changed).  -  The
second column indicates whether the button representing this action will
appear on the submission page.  -  The third column shows you the number
of pages composing the web form for this implementation. (see <a class="reference external" href="#implementwebform">create
and maintain the web form</a>).  -  The 4th and 5th
columns indicate the creation and last modification dates for this
implementation.  -  In the 6th column, you can find the order in which
the button will be displayed on the submission page of this document
type.  -  The following 4 columns (level, score, stpage, endtxt) deal
with the insertion of this action in an action set.</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">An action set is a succession of actions which should be done in a
given order when a user starts.
For example the submission of a document is usually composed of two
actions: Submission of Bibliographic Information (SBI) and Fulltext
Transfer (FTT) which should be done one after the other.
When the user starts the submission, we want CDS Submit to get him
first in SBI and when he finishes SBI to carry him to FTT.
SBI and FTT are in this case in the same action set.
They will both have a level of 1 (&#8220;level&#8221; is a bad name, it should
be &#8220;action set number&#8221;), SBI will have a score of 1, and FTT a score of
2 (which means it will be started after SBI). If you set the stpage of
FTT to 2, the user will be directly carried to the 2nd page of the FTT
web form. This value is usually set to 1.   | |  The endtxt field
contains the text which will be display to the user at the end of the
first action (here it could be &#8220;you now have to transfer your files&#8221;)
A single action like &#8220;Modify Bibliographic Information&#8221; should have
the 3 columns to 0,0 and 1.</p>
</div>
<ul class="simple">
<li>Click on the icon in the 12th column (&#8220;Edit Submission Pages&#8221;) to
<a class="reference external" href="#implementwebform">create or edit the web form</a>.</li>
<li>Click on the icon in the 13th column (&#8220;Edit Functions&#8221;) to
<a class="reference external" href="#implementfunctions">create or edit the function list</a>.</li>
<li>The &#8220;Edit Submission&#8221; column allows you to modify the data
(level, status text...) for this implementation.</li>
<li>Finally the last column allows you to delete this implementation.</li>
</ul>
<p>If you chose to clone the implementation from an existing one,
the web form as well as the functions list will already be defined.
Else you will have to create them from scratch.</p>
</div>
<div class="section" id="id31">
<h3>See also:<a class="headerlink" href="#id31" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><a class="reference external" href="#implementwebform">create and maintain the web form</a></li>
<li><a class="reference external" href="#implementfunctions">create and maintain the data treatment</a></li>
</ul>
</div>
</div>
<div class="section" id="create-and-maintain-the-web-form">
<h2>Create and maintain the web form<a class="headerlink" href="#create-and-maintain-the-web-form" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id32">
<h3>What is it?<a class="headerlink" href="#id32" title="Permalink to this headline">¶</a></h3>
<p>Create and define the web form used during an action.</p>
</div>
<div class="section" id="id33">
<h3>How to get there?<a class="headerlink" href="#id33" title="Permalink to this headline">¶</a></h3>
<p>From the main page of the manager, click on the title of the
relevant document type. Then click on the icon in the &#8220;Edit
Submission Pages&#8221; column of the relevant line.</p>
</div>
<div class="section" id="list-of-the-form-pages">
<h3>List of the form pages<a class="headerlink" href="#list-of-the-form-pages" title="Permalink to this headline">¶</a></h3>
<p>A web form can be split over several pages. This is a matter of
easiness for the user: he will have an overview of all form fields
present on the page without having to scroll it. Moreover, each time
the user goes from one page to the other, all entered data are
saved. If he wants to stop then come back later (or if the browser
crashes!) he will be able to get back to the submission at the exact
moment he left it.</p>
<p>Once here:
<a href="#id73"><span class="problematic" id="id74">|image15|</span></a></p>
<p>you can see the ordered list of already existing pages in the web
form. In this example there are 4 pages. You can then:</p>
<ul class="simple">
<li>Move one page from one place to an other, using the small blue
arrows under each page number.</li>
<li>Suppress one page by clicking on the relevant red cross.</li>
<li>Add a page, by clicking the &#8220;ADD A PAGE&#8221; button!</li>
<li><a class="reference external" href="#onepage">Edit the content of one page</a> by clicking on the
page number.</li>
<li>Go back to the document main page.</li>
</ul>
</div>
<div class="section" id="edit-one-form-page">
<h3>Edit one form page<a class="headerlink" href="#edit-one-form-page" title="Permalink to this headline">¶</a></h3>
<p>Click on a page number, you then arrive to a place where you can
edit this form page.</p>
<p>A form page is composed of a list of form elements. Each of
these form elements is roughly made of an html template and a text
displayed before the form field.</p>
<p>In the first part of the page, you have a preview of what the
form will look like to the user:
<a href="#id75"><span class="problematic" id="id76">|image16|</span></a></p>
<p>Then the second table shows you the list of the form elements
present on the page:
<a href="#id77"><span class="problematic" id="id78">|image17|</span></a></p>
<p>You can then:</p>
<ul class="simple">
<li>Move one element from one place to another using the drop-down
menus in the first column (&#8220;Item No&#8221;) of the table, or the little
blue arrows in the second column.</li>
<li><a class="reference external" href="#edittemplate">Edit the html template of one form element</a> by
clicking on the name of the template in the 3rd column (&#8220;Name&#8221;).</li>
<li><a class="reference external" href="#editelement">Edit one of the form elements</a> by clicking on
the icon in the 10th column.</li>
<li>delete one form element by clicking on the relevant red cross.</li>
<li><a class="reference external" href="#addelement">Add an element to the page</a> by clicking the &#8220;ADD
ELEMENT TO PAGE&#8221; button.</li>
</ul>
</div>
<div class="section" id="edit-the-html-template-of-one-form-element">
<h3>Edit the html template of one form element<a class="headerlink" href="#edit-the-html-template-of-one-form-element" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><blockquote>
<div>In the html template edition page, you can modify the following</div></blockquote>
<p>values:</p>
<ul class="simple">
<li><strong>Element type</strong>: indicates which html form element to create</li>
<li><strong>Aleph code</strong>: Aleph users only! - This indicates in which field
of the Aleph document database to retrieve the original value
when modifying this information (function
Create_Modify_Interface of action MBI).</li>
<li><strong>Marc Code</strong>: MySQL users only! - This indicates in which field
of the MySQL document database to retrieve the original value
when modifying this information (function
Create_Modify_Interface of action MBI).</li>
<li><strong>Cookies</strong>: indicates whether WebSubmit will set a cookie on the
value filled in by the user. If yes, next time the user will come
to this submission, the value he has entered last time will be
filled in automatically. Note: This feature has been REMOVED.</li>
<li><strong>other fields</strong>: The other fields help defining the html form
element.</li>
</ul>
<p>Important warning! Please remember this is a template! This means it
can be used in many different web forms/implementations. When you
modify this template the modification will take place in each of the
implementations this template has been used.</p>
</div></blockquote>
</div>
<div class="section" id="edit-one-form-element">
<h3>Edit one form element<a class="headerlink" href="#edit-one-form-element" title="Permalink to this headline">¶</a></h3>
<p>In the form element edition page, you may modify the following
values:</p>
<ul class="simple">
<li><strong>element label</strong>: This is the text displayed before the actual
form field.</li>
<li><strong>level</strong>: can be one of &#8220;mandatory&#8221; or &#8220;optional&#8221;. If mandatory,
the user won&#8217;t be able to leave this page before filling this
field in.</li>
<li><strong>short desc</strong>: This is the text displayed in the summary window
when it is opened.</li>
<li><strong>Check</strong>: Select here the <a class="reference external" href="#addcheck">javascript checking
function</a> to be applied to the submitted value of
this field</li>
<li><strong>Modify Text</strong>: This text will be displayed before the form
field when modifying the value (action &#8220;Modify Record&#8221;, function
&#8220;Create_Modify_Interface&#8221;)</li>
</ul>
</div>
<div class="section" id="add-one-form-element">
<h3>Add one form element<a class="headerlink" href="#add-one-form-element" title="Permalink to this headline">¶</a></h3>
<p>Click on the &#8220;ADD ELEMENT TO PAGE&#8221; button. There you will have to
decide which <a class="reference external" href="#addtemplate">html template field</a> to use (&#8220;Element
Description code&#8221;), and also the field mentioned
<a class="reference external" href="#editelement">above</a>.</p>
</div>
<div class="section" id="create-a-new-html-template">
<h3>Create a new html template<a class="headerlink" href="#create-a-new-html-template" title="Permalink to this headline">¶</a></h3>
<p>You have access to the list of all existing html templates by
clicking on the &#8220;View element descriptions&#8221; link in the websubmit
admin right menu.</p>
<p>By clicking on one of them, you will have access to its
description.</p>
<p>If no template corresponds to the one you seek, click on the &#8220;ADD
NEW ELEMENT DESCRIPTION&#8221; button to create one.
The fields you have to enter in the creation form are the one
described in the <a class="reference external" href="#edittemplate">Edit the html template of one form
element</a> section.</p>
<p>You also have to choose a name for this new element.
IMPORTANT! The name you choose for your html element is also the
name of the file in which webSubmit will save the value entered in
this field. This is also the one you will use in your
<a class="reference external" href="#bibconvert">BibConvert</a> configuration. Bibconvert is the
program which will convert the data gathered in webSubmit in a
formatted XML file for insertion in the documents database.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Elements of type &#8220;select box&#8221; which are used as a mandatory field in
a form must start with &#8220;&lt;option&gt;Select:&lt;/option&gt;&#8221;</p>
</div>
</div>
<div class="section" id="create-and-edit-a-checking-function">
<h3>Create and edit a checking function.<a class="headerlink" href="#create-and-edit-a-checking-function" title="Permalink to this headline">¶</a></h3>
<p>Click on the &#8220;View Checks&#8221; link in the websubmit admin right menu.
You then have access to a list of all the defined javascript
functions.</p>
<p>You can then click on the name of the function you want to modify,
or click on the &#8220;ADD NEW CHECK&#8221; button to create a new javascript
function.</p>
<p>These functions are inserted in the web page when the user is doing
his submission. When he clicks on &#8220;next page&#8221;, this function will be
called with the value entered by the user as a parameter. If the
function returns false, the page does not change and an error
message should be output. If the function returns true, everything
is correct, so page can be changed.</p>
</div>
<div class="section" id="id34">
<h3>See also:<a class="headerlink" href="#id34" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><a class="reference external" href="#implementfunctions">create and maintain the data treatment</a></li>
</ul>
</div>
</div>
<div class="section" id="setup-the-data-treatment">
<h2>Setup the Data Treatment<a class="headerlink" href="#setup-the-data-treatment" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id35">
<h3>What is it?<a class="headerlink" href="#id35" title="Permalink to this headline">¶</a></h3>
<p>At the end of a submission, we have to tell webSubmit what to do
with the data it has gathered. This is expressed through one or
several lists of functions (we call this the &#8220;end script&#8221;).</p>
</div>
<div class="section" id="id36">
<h3>How to get there?<a class="headerlink" href="#id36" title="Permalink to this headline">¶</a></h3>
<p>From the main page of the manager, click on the title of the
relevant document type.
Then click on the icon in the &#8220;Edit Functions&#8221; column of the
relevant line.</p>
</div>
<div class="section" id="list-of-functions">
<h3>List of functions<a class="headerlink" href="#list-of-functions" title="Permalink to this headline">¶</a></h3>
<p>Here is what you may see then (this is the end script list of
functions for a document type named &#8220;TEST&#8221; and action &#8220;FTT&#8221; -
Fulltext Transfer):
<a href="#id79"><span class="problematic" id="id80">|image18|</span></a></p>
<p>You can see the ordered list of all the functions in the end
script. This end script is composed of 2 steps (see the &#8220;step&#8221;
column). The functions composing the first step are called, then
there should be action from the user which would trigger step 2 - in
the present case the <a class="reference external" href="#Upload_Files">Upload_Files</a> function
(last of step 1) allows the user to upload additional files by
creating a web form, then when the user finishes, he presses another
button created by the function, which ends the process. Functions of
step 2 are then called.</p>
<p>Why implement multiple steps? The reason can vary with the task
you want to accomplish. For example with the example above (Fulltext
Transfer), we use the first step to allow the upload of multiple
additional files (dynamic action) which could not be done in the
<a class="reference external" href="#implementwebform">static web form</a>. In the case of the &#8220;Modify
Bibliographic Information&#8221; action, the first step is used to display
the fields the user wants to modify, prefilled with the existing
values. The reason is once again that the task we want to realise is
dynamic.</p>
<p>The &#8220;score&#8221; column is used to order the functions. The function
which has the smallest score will be called first, and the largest
score will be called last.</p>
<p>You can then:</p>
<ul class="simple">
<li>View and edit the parameters of each function by clicking on the
name of the function.</li>
<li>Move one function up and down, by using the small blue arrows.</li>
<li>Suppress one function by clicking on the relevant red cross.</li>
<li>Add a function to the list by clicking the &#8220;ADD FUNCTION&#8221; button.</li>
<li>Go back to the document main page (&#8220;FINISHED&#8221; button).</li>
</ul>
<p>Please note: To pass one function from one step to another, you
have to delete it then add it again in the proper step.</p>
</div>
<div class="section" id="id37">
<h3>See also:<a class="headerlink" href="#id37" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><a class="reference external" href="#functions">all about functions</a></li>
</ul>
</div>
</div>
<div class="section" id="functions">
<h2>Functions<a class="headerlink" href="#functions" title="Permalink to this headline">¶</a></h2>
<div class="section" id="description">
<h3>Description:<a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h3>
<p>In webSubmit, each action process is divided into two phases: the
gathering of data (through a web form) and the treatment of the
data.</p>
<p>The treatment is organised in a succession of functions, each of
which has its own input and output.
The functions themselves are stored in separate files (one per
function) in the
<tt class="docutils literal"><span class="pre">/opt/invenio/lib/python/invenio/websubmit\_functions</span></tt> directory. A
file containing a function MUST be named after the function name
itself. For example, a function called &#8220;Move_to_Done&#8221; MUST be
stored in a file called Move_to_Done.py. The case is important
here.</p>
<p>For a description of what should be inside the file, have a look
to the &#8220;create a new function&#8221; page of this guide.
To each function you can associate one or several parameters,
which may have different values according to the document type the
function is used for. One parameter may be used for different
functions. For example one standard parameter used in several
functions is called &#8220;edsrn&#8221;. It contains the name of the file in
which the reference of the document is stored.</p>
</div>
<div class="section" id="id38">
<h3>See also:<a class="headerlink" href="#id38" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><a class="reference external" href="#functionnew">create a new function</a></li>
<li><a class="reference external" href="#functiondelete">delete a function</a></li>
<li><a class="reference external" href="#functionedit">edit a function</a></li>
</ul>
</div>
</div>
<div class="section" id="id39">
<h2>Creating a New Function<a class="headerlink" href="#id39" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id40">
<h3>How to get there?<a class="headerlink" href="#id40" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><blockquote>
<div>Click on the &#8220;Available Functions&#8221; link in the websubmit admin</div></blockquote>
<p>right menu. Then click on the &#8220;Add New Function&#8221; button.</p>
</div></blockquote>
</div>
<div class="section" id="id41">
<h3>How to do this?<a class="headerlink" href="#id41" title="Permalink to this headline">¶</a></h3>
<p>Enter the name of the new function as well as a text description if you wish.
You will then reach a page where you can add parameters to your new function.</p>
<p>Don&#8217;t forget to add the function file inside the
<tt class="docutils literal"><span class="pre">/opt/invenio/lib/python/invenio/websubmit\_functions</span></tt> directory and
to name the file after the function. Functions must be written in
Python. Here is an example implementation of a function:</p>
<p><tt class="docutils literal"><span class="pre">/opt/invenio/lib/python/invenio/websubmit\_functions/Get\_Report\_Number.py</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">Get_Report_Number</span> <span class="p">(</span><span class="n">parameters</span><span class="p">,</span><span class="n">curdir</span><span class="p">,</span><span class="n">form</span><span class="p">):</span>
    <span class="k">global</span> <span class="n">rn</span>

    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s">/</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">curdir</span><span class="p">,</span><span class="n">parameters</span><span class="p">[</span><span class="s">&#39;edsrn&#39;</span><span class="p">])):</span>
        <span class="n">fp</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s">/</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">curdir</span><span class="p">,</span><span class="n">parameters</span><span class="p">[</span><span class="s">&#39;edsrn&#39;</span><span class="p">]),</span><span class="s">&quot;r&quot;</span><span class="p">)</span>
        <span class="n">rn</span> <span class="o">=</span> <span class="n">fp</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="n">rn</span> <span class="o">=</span> <span class="n">rn</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot;/&quot;</span><span class="p">,</span><span class="s">&quot;_&quot;</span><span class="p">)</span>
        <span class="n">rn</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">&quot;[</span><span class="se">\n\r</span><span class="s"> ]+&quot;</span><span class="p">,</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="n">rn</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">rn</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
    <span class="k">return</span> <span class="s">&quot;&quot;</span>
</pre></div>
</div>
<p>The function parameters are passed to the function through the parameters dictionary.
The curdir parameter contains the current submission directory path.
The form parameter contains the form passed to the current web page for possible reference from inside the
function.</p>
</div>
<div class="section" id="id42">
<h3>See also:<a class="headerlink" href="#id42" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p class="first">edit a function</p>
</li>
<li><p class="first">delete a function</p>
<blockquote>
<div><p>Removing a Function</p>
<blockquote>
<div><p>Note</p>
<blockquote>
<div><blockquote>
<div><p>There are currently no way of deleting a function through this</p>
</div></blockquote>
<p>interface. Use the direct MySQL command line interface for this.</p>
</div></blockquote>
<p>See also:</p>
<blockquote>
<div><p>edit a function
create a function</p>
</div></blockquote>
</div></blockquote>
<p>Editing a Function</p>
<blockquote>
<div><p>What is it?</p>
<blockquote>
<div><p>Edit a function, add parameters to it...</p>
</div></blockquote>
<p>How to get there?</p>
<blockquote>
<div><blockquote>
<div><p>Click on the &#8220;Available Functions&#8221; link in the websubmit admin</p>
</div></blockquote>
<p>right menu.</p>
</div></blockquote>
<p>How to do this?</p>
<blockquote>
<div><blockquote>
<div><p>On this page appears a list of all functions defined into the system.</p>
</div></blockquote>
<p>Two columns give you access to some features:</p>
<blockquote>
<div><p>View function usage Click here to have access to the list of all document
types and all actions in which this function is used. Then by clicking on one of the items, you will be given a
chance to modify the parameters value for the given document type.
View/Edit function details There you will be able to modify the function
description, as well as add/withdraw parameters for this function.</p>
</div></blockquote>
</div></blockquote>
<p>See also:</p>
<blockquote>
<div><p>create a new function
delete a function</p>
</div></blockquote>
</div></blockquote>
<p>All functions explained</p>
<blockquote>
<div><p>Description:</p>
<blockquote>
<div><blockquote>
<div><p>This page lists and explains all the functions used in the demo</p>
</div></blockquote>
<dl class="docutils">
<dt>provided with the Invenio package. This list is not exhaustive since you can add any new function you need.</dt>
<dd><p class="first last">Click on one function name to get its description.
Please note in this page when we refer to [param] this means the</p>
</dd>
</dl>
<p>value of the parameter &#8216;param&#8217; for a given document type.</p>
<blockquote>
<div><p>CaseEDS
Create_Modify_Interface
Create_Recid
Finish_Submission
Get_Info
Get_Recid
Get_Report_Number
Get_Sysno
Get_TFU_Files
Insert_Modify_Record
Insert_Record</p>
<p>Is_Original_Submitter
Is_Referee
Mail_Submitter
Make_Modify_Record
Make_Record
Move_From_Pending
Move_to_Done
Move_to_Pending
Print_Success
Print_Success_APP
Print_Success_MBI</p>
<p>Print_Success_SRV
Report_Number_Generation
Send_Approval_Request
Send_APP_Mail
Send_Modify_Mail
Send_SRV_Mail
Test_Status
Update_Approval_DB
Upload_Files</p>
</div></blockquote>
</div></blockquote>
<p>CaseEDS
description</p>
<blockquote>
<div><p>This function may be used if the treatment to be done after a submission depends on a field entered by
the user. Typically this is used in an approval interface. If the referee approves then we do this. If he rejects,
then we do other thing.
More specifically, the function gets the value from the file named [casevariable] and compares it with the
values stored in [casevalues]. If a value matches, the function directly goes to the corresponding step stored
in [casesteps]. If no value is matched, it goes to step [casedefault].</p>
</div></blockquote>
<p>parameters</p>
<blockquote>
<div><p>casevariable</p>
<blockquote>
<div><p>This parameters contains the name of the file in which the function will get the chosen value.
Eg: &#8220;decision&#8221;</p>
</div></blockquote>
<p>casevalues</p>
<blockquote>
<div><p>Contains the list of recognized values to match with the chosen value. Should be a comma separated list of words.
Eg: &#8220;approve,reject&#8221;</p>
</div></blockquote>
<p>casesteps</p>
<blockquote>
<div><p>Contains the list of steps corresponding to the values matched in [casevalue]. It should be a comma
separated list of numbers
Eg: &#8220;2,3&#8221;
In this example, if the value stored in the file named &#8220;decision&#8221; is &#8220;approved&#8221;, then the function launches
step 2 of this action. If it is &#8220;reject&#8221;, then step 3 is launched.</p>
</div></blockquote>
<p>casedefault</p>
<blockquote>
<div><p>Contains the step number to go by default if no match is found.
Eg: &#8220;4&#8221;
In this example, if the value stored in the file named &#8220;decision&#8221; is not &#8220;approved&#8221; nor &#8220;reject&#8221;, then
step 4 is launched.</p>
</div></blockquote>
</div></blockquote>
<p>Create_Modify_Interface
description</p>
<blockquote>
<div><p>To be used in the MBI-Modify Record action.
It displays a web form allowing the user to modify the fields he chose. The fields are prefilled with the existing
values extracted from the documents database.
This functions takes the values stored in the [fieldnameMBI] file. This file contains a list of field name separated
with &#8220;+&#8221; (it is usually generated from a multiple select form field). Then the function retrieves the corresponding
tag name (marc-21) stored in the element definition. Finally it displays the web form and fills it with the existing
values found in the documents database.</p>
</div></blockquote>
<p>parameters</p>
<blockquote>
<div><p>fieldnameMBI</p>
<blockquote>
<div><p>Contains the name of the file in which the function will find the list of fields the user wants to modify. Depends
on the web form configuration.</p>
</div></blockquote>
</div></blockquote>
<p>Create_Recid
description</p>
<blockquote>
<div><p>This function retrieves a new record id from the records database. This record id will then be used to create the
XML record afterwards, or to link with the fulltext files. The created id is stored in a file named &#8220;SN&#8221;.</p>
</div></blockquote>
<p>parameters</p>
<blockquote>
<div><p>none</p>
</div></blockquote>
<p>Finish_Submission
description</p>
<blockquote>
<div><p>This function stops the data treatment process even if further steps exist. This is used for example in the
approval action. In the first step, the program determines whether the user approved or rejected the
document (see CaseEDS function description). Then depending on  the result, it
executes step 2 or step 3. If it executes step 2, then it should continue with step 3 if nothing stopped it. The
Finish_Submission function plays this role.</p>
</div></blockquote>
<p>parameters</p>
<blockquote>
<div><p>none</p>
</div></blockquote>
<p>Get_Info
description</p>
<blockquote>
<div><p>This function tries to retrieve in the &#8220;pending&#8221; directory or directly in the documents database, some information
about the document: title, original submitter&#8217;s email and author(s).
If found, this information is stored in 3 global variables: $emailvalue, $titlevalue, $authorvalue to be used
in other functions.
If not found, an error message is displayed.</p>
</div></blockquote>
<p>parameters</p>
<blockquote>
<div><p>authorFile</p>
<blockquote>
<div><p>Name of the file in which the author may be found if the document has not yet been integrated (in this case
it is still in the &#8220;pending&#8221; directory).</p>
</div></blockquote>
<p>emailFile</p>
<blockquote>
<div><p>Name of the file in which the email of the original submitter may be found if the document has not yet been
integrated (in this case it is still in the &#8220;pending&#8221; directory).</p>
</div></blockquote>
<p>titleFile</p>
<blockquote>
<div><p>Name of the file in which the title may be found if the document has not yet been integrated (in this case it is
still in the &#8220;pending&#8221; directory).</p>
</div></blockquote>
</div></blockquote>
<p>Get_Recid
description</p>
<blockquote>
<div><p>This function searches for the document in the database and stores the recid of this document in the &#8220;SN&#8221; file and in a global variable &#8220;sysno&#8221;.
The function conducts the search based upon the document&#8217;s report-number (and relies upon the global variable &#8220;rn&#8221;) so the &#8220;Get_Report_Number&#8221; function should be called before this one.
This function replaces the older function &#8220;Get_Sysno&#8221;.</p>
</div></blockquote>
<p>parameters</p>
<blockquote>
<div><p>none</p>
</div></blockquote>
<p>Get_Report_Number
description</p>
<blockquote>
<div><p>This function gets the value contained in the [edsrn] file and stores it in the reference global variable.</p>
</div></blockquote>
<p>parameters</p>
<blockquote>
<div><p>edsrn</p>
<blockquote>
<div><p>Name of the file which stores the reference.
This value depends on the web form configuration you did. It should contain the name of the form element used for storing the reference of the document.</p>
</div></blockquote>
</div></blockquote>
<p>Get_Sysno
description</p>
<blockquote>
<div><p>This function searches for the document in the database and stores the system number of this document in the &#8220;SN&#8221; file and in a global variable.
&#8220;Get_Report_Number&#8221; should be called before.
Deprecated: Use Get_Recid instead.</p>
</div></blockquote>
<p>parameters</p>
<blockquote>
<div><p>none</p>
</div></blockquote>
<p>Insert_Modify_Record
description</p>
<blockquote>
<div><p>This function gets the output of bibconvert and uploads it into the MySQL bibliographical database.</p>
</div></blockquote>
<p>parameters</p>
<blockquote>
<div><p>none</p>
</div></blockquote>
<p>Insert_Record
description</p>
<blockquote>
<div><p>This function gets the output of bibFormat and uploads it into the MySQL bibliographical database.</p>
</div></blockquote>
<p>parameters</p>
<blockquote>
<div><p>none</p>
</div></blockquote>
<p>Is_Original_Submitter
description</p>
<blockquote>
<div><p>If the authentication module (login) is active in webSubmit, this function compares the current login with the email of the original submitter. If it is the same (or if the current user has superuser rights), we go on. If it differs, an error message is issued.</p>
</div></blockquote>
<p>parameters</p>
<blockquote>
<div><p>none</p>
</div></blockquote>
<p>Is_Referee
description</p>
<blockquote>
<div><p>This function checks whether the currently logged user is a referee for this document.</p>
</div></blockquote>
<p>parameters</p>
<blockquote>
<div><p>none</p>
</div></blockquote>
<p>Mail_Submitter
description</p>
<blockquote>
<div><p>This function send an email to the submitter to warn him the document he has just submitted has been
correctly received.</p>
</div></blockquote>
<p>parameters</p>
<blockquote>
<div><p>authorfile</p>
<blockquote>
<div><p>Name of the file containing the authors of the document</p>
</div></blockquote>
<p>titleFile</p>
<blockquote>
<div><p>Name of the file containing the title of the document</p>
</div></blockquote>
<p>emailFile</p>
<blockquote>
<div><p>Name of the file containing the email of the submitter of the document</p>
</div></blockquote>
<p>status</p>
<blockquote>
<div><p>Depending on the value of this parameter, the function adds an additional text to the email.
This parameter can be one of:
ADDED: The file has been integrated in the database.
APPROVAL: The file has been sent for approval to a referee.
or can stay empty.</p>
</div></blockquote>
<p>edsrn</p>
<blockquote>
<div><p>Name of the file containing the reference of the document</p>
</div></blockquote>
<p>newrnin</p>
<blockquote>
<div><p>Name of the file containing the 2nd reference of the document (if any)</p>
</div></blockquote>
</div></blockquote>
<p>Make_Modify_Record
description</p>
<blockquote>
<div><p>This function creates the record file formatted for a direct insertion in the documents database. It uses the
BibConvert tool.
The main difference between all the Make_..._Record functions are the parameters.
As its name says, this particular function should be used for the modification of a record. (MBI- Modify
Record action).</p>
</div></blockquote>
<p>parameters</p>
<blockquote>
<div><p>modifyTemplate</p>
<blockquote>
<div><p>Name of bibconvert&#8217;s configuration file used for creating the mysql record.</p>
</div></blockquote>
<p>sourceTemplate</p>
<blockquote>
<div><p>Name of bibconvert&#8217;s source file.</p>
</div></blockquote>
</div></blockquote>
<p>Make_Record
description</p>
<blockquote>
<div><p>This function creates the record file formatted for a direct insertion in the documents database. It uses the
BibConvert tool.
The main difference between all the Make_..._Record functions are the parameters.
As its name does not say :), this particular function should be used for the submission of a document.</p>
</div></blockquote>
<p>parameters</p>
<blockquote>
<div><p>createTemplate</p>
<blockquote>
<div><p>Name of bibconvert&#8217;s configuration file used for creating the mysql record.</p>
</div></blockquote>
<p>sourceTemplate</p>
<blockquote>
<div><p>Name of bibconvert&#8217;s source file.</p>
</div></blockquote>
</div></blockquote>
<p>Move_From_Pending
description</p>
<blockquote>
<div><p>This function retrieves the data of a submission which was temporarily stored in the &#8220;pending&#8221; directory
(waiting for an approval for example), and moves it to the current action directory.</p>
</div></blockquote>
<p>parameters</p>
<blockquote>
<div><p>none</p>
</div></blockquote>
<p>Move_to_Done
description</p>
<blockquote>
<div><p>This function moves the existing submission directory to the /opt/invenio/var/data/submit/storage/done directory. If the
Then it tars and gzips the directory.</p>
</div></blockquote>
<p>parameters</p>
<blockquote>
<div><p>none</p>
</div></blockquote>
<p>Move_to_Pending
description</p>
<blockquote>
<div><p>This function moves the existing submission directory to the /opt/invenio/var/data/submit/storage/pending directory. It is
used to store temporarily this data until it is approved or...</p>
</div></blockquote>
<p>parameters</p>
<blockquote>
<div><p>none</p>
</div></blockquote>
<p>Print_Success
description</p>
<blockquote>
<div><p>This function simply displays a text on the screen, telling the user the submission went fine. To be used in
the &#8220;Submit New Record&#8221; action.</p>
</div></blockquote>
<p>parameters</p>
<blockquote>
<div><p>status</p>
<blockquote>
<div><p>Depending on the value of this parameter, the function adds an additional text to the email.
This parameter can be one of:
ADDED: The file has been integrated in the database.
APPROVAL: The file has been sent for approval to a referee.
or can stay empty.</p>
</div></blockquote>
<p>edsrn</p>
<blockquote>
<div><p>Name of the file containing the reference of the document</p>
</div></blockquote>
<p>newrnin</p>
<blockquote>
<div><p>Name of the file containing the 2nd reference of the document (if any)</p>
</div></blockquote>
</div></blockquote>
<p>Print_Success_APP
description</p>
<blockquote>
<div><p>This function simply displays a text on the screen, telling the referee his decision has been taken into account.
To be used in the Approve (APP) action.</p>
</div></blockquote>
<p>parameters</p>
<blockquote>
<div><p>none</p>
</div></blockquote>
<p>Print_Success_MBI
description</p>
<blockquote>
<div><p>This function simply displays a text on the screen, telling the user the modification went fine. To be used in
the Modify Record (MBI) action.</p>
</div></blockquote>
<p>parameters</p>
<blockquote>
<div><p>none</p>
</div></blockquote>
<p>Print_Success_SRV
description</p>
<blockquote>
<div><p>This function simply displays a text on the screen, telling the user the revision went fine. To be used in the
Submit New File (SRV) action.</p>
</div></blockquote>
<p>parameters</p>
<blockquote>
<div><p>none</p>
</div></blockquote>
<p>Report_Number_Generation
description</p>
<blockquote>
<div><p>This function is used to automatically generate a reference number.
After generating the reference, the function saves it into the [newrnin] file and sets the global variable
containing this reference.</p>
</div></blockquote>
<p>parameters</p>
<blockquote>
<div><p>autorngen</p>
<blockquote>
<div><p>If set to &#8220;Y&#8221;: The reference number is generated.
If set to &#8220;N&#8221;: The reference number is read from a file ([newrnin])
If set to &#8220;A&#8221;: The reference number will be the access number of the submission.</p>
</div></blockquote>
<p>counterpath</p>
<blockquote>
<div><p>indicates the file in which the program will find the counter for this reference generation.
The value of this parameter may contain one of:
&#8220;&lt;PA&gt;categ&lt;/PA&gt;&#8221;: in this case this string is replaced with the content of the file [altrnin]
&#8220;&lt;PA&gt;yy&lt;/PA&gt;&#8221;: in this case this string is replaced by the current year (4 digits) if [altyeargen]
is set to &#8220;AUTO&#8221;, or by the content of the [altyeargen] file in any other case. (this content should be formatted
as a date (dd/mm/yyyy).
&#8220;&lt;PA&gt;file:name_of_file&lt;/PA&gt;&#8221;: in this case, this string is replaced by the first line of the given file
&#8220;&lt;PA&gt;file*:name_of_file&lt;/PA&gt;&#8221;: in this case, this string is replaced by all the lines of the given file, separated by a dash (&#8216;-&#8216;) character.</p>
</div></blockquote>
<p>rnformat</p>
<blockquote>
<div><p>This is the format used by the program to create the reference. The program computes the value of the
parameter and appends a &#8220;-&#8221; followed by the current value of the counter increased by 1.
The value of this parameter may contain one of:
&#8220;&lt;PA&gt;categ&lt;/PA&gt;&#8221;: in this case this string is replaced with the content of the file [altrnin]
&#8220;&lt;PA&gt;yy&lt;/PA&gt;&#8221;: in this case this string is replaced by the current year (4 digits) if [altyeargen]
is set to &#8220;AUTO&#8221;, or by the content of the [altyeargen] file in any other case. (this content should be formatted
as a date (dd/mm/yyyy).</p>
<p>&#8220;&lt;PA&gt;file:name_of_file&lt;/PA&gt;&#8221;: in this case, this string is replaced by the first line of the given file
&#8220;&lt;PA&gt;file*:name_of_file&lt;/PA&gt;&#8221;: in this case, this string is replaced by all the lines of the given file, separated by a dash (&#8216;-&#8216;) character.</p>
</div></blockquote>
<p>rnin</p>
<blockquote>
<div><p>This parameter contains the name of the file in which the program will find the category if needed. The content
of thif file will then replace the string &lt;PA&gt;categ&lt;/PA&gt; in the reference format or in the counter
path.</p>
</div></blockquote>
<p>yeargen</p>
<blockquote>
<div><p>This parameter can be one of:
&#8220;AUTO&#8221;: in this case the program takes the current 4 digit year.
&#8220;&lt;filename&gt;&#8221;: in this case the program extract the year from the file which name is
&lt;filename&gt;. This file should contain a date (dd/mm/yyyy).</p>
</div></blockquote>
<p>edsrn</p>
<blockquote>
<div><p>Name of the file in which the created reference will be stored.</p>
</div></blockquote>
</div></blockquote>
<p>Send_Approval_Request
description</p>
<blockquote>
<div><p>This function sends an email to the referee in order to start the simple approval process.
This function is very CERN-specific and should be changed in case of external use.
Must be called after the Get_Report_Number function.</p>
</div></blockquote>
<p>parameters</p>
<blockquote>
<div><p>addressesDAM</p>
<blockquote>
<div><p>email addresses of the people who will receive this email (comma separated list). this parameter may contain the &lt;CATEG&gt; string. In which case the variable computed from the [categformatDAM] parameter replaces this string.
eg.: &#8220;&lt;CATEG&gt;-<a class="reference external" href="mailto:email&#37;&#52;&#48;cern&#46;ch">email<span>&#64;</span>cern<span>&#46;</span>ch</a>&#8220;</p>
</div></blockquote>
<p>categformatDAM</p>
<blockquote>
<div><p>contains a regular expression used to compute the category of the document given the reference of the document.
eg.: if [categformatAFP]=&#8221;TEST-&lt;CATEG&gt;-.*&#8221; and the reference of the document is &#8220;TEST-CATEGORY1-2001-001&#8221;, then the computed category equals &#8220;CATEGORY1&#8221;</p>
</div></blockquote>
<p>authorfile</p>
<blockquote>
<div><p>name of the file in which the authors are stored</p>
</div></blockquote>
<p>titlefile</p>
<blockquote>
<div><p>name of the file in which the title is stored.</p>
</div></blockquote>
<p>directory</p>
<blockquote>
<div><p>parameter used to create the URL to access the files.</p>
</div></blockquote>
</div></blockquote>
<p>Send_APP_Mail
description</p>
<blockquote>
<div><p>Sends an email to warn people that a document has been approved.</p>
</div></blockquote>
<p>parameters</p>
<blockquote>
<div><p>addressesAPP</p>
<blockquote>
<div><p>email addresses of the people who will receive this email (comma separated list). this parameter may contain
the &lt;CATEG&gt; string. In which case the variable computed from the [categformatAFP] parameter
replaces this string.
eg.: &#8220;&lt;CATEG&gt;-<a class="reference external" href="mailto:email&#37;&#52;&#48;cern&#46;ch">email<span>&#64;</span>cern<span>&#46;</span>ch</a>&#8220;</p>
</div></blockquote>
<p>categformatAPP</p>
<blockquote>
<div><p>contains a regular expression used to compute the category of the document given the reference of the
document.
eg.: if [categformatAFP]=&#8221;TEST-&lt;CATEG&gt;-.*&#8221; and the reference of the document is
&#8220;TEST-CATEGORY1-2001-001&#8221;, then the computed category equals &#8220;CATEGORY1&#8221;</p>
</div></blockquote>
<p>newrnin</p>
<blockquote>
<div><p>Name of the file containing the 2nd reference of the approved document (if any).</p>
</div></blockquote>
<p>edsrn</p>
<blockquote>
<div><p>Name of the file containing the reference of the approved document.</p>
</div></blockquote>
</div></blockquote>
<p>Send_Modify_Mail
description</p>
<blockquote>
<div><p>This function sends an email to warn people a document has been modified and the user his modifications
have been taken into account..</p>
</div></blockquote>
<p>parameters</p>
<blockquote>
<div><p>addressesMBI</p>
<blockquote>
<div><p>email addresses of the people who will receive this email (comma separated list).</p>
</div></blockquote>
<p>fieldnameMBI</p>
<blockquote>
<div><p>name of the file containing the modified fields.</p>
</div></blockquote>
<p>sourceDoc</p>
<blockquote>
<div><p>Long name for the type of document. This name will be displayed in the mail.</p>
</div></blockquote>
<p>emailfile</p>
<blockquote>
<div><p>name of the file in which the email of the modifier will be found.</p>
</div></blockquote>
</div></blockquote>
<p>Send_SRV_Mail
description</p>
<blockquote>
<div><p>This function sends an email to warn people a revision has been carried out.</p>
</div></blockquote>
<p>parameters</p>
<blockquote>
<div><p>notefile</p>
<blockquote>
<div><p>name of the file in which the note can be found</p>
</div></blockquote>
<p>emailfile</p>
<blockquote>
<div><p>name of the file containing the submitter&#8217;s email</p>
</div></blockquote>
<p>addressesSRV</p>
<blockquote>
<div><p>email addresses of the people who will receive this email (comma separated list). this parameter may contain the &lt;CATEG&gt; string. In which case the variable computed from the [categformatDAM] parameter replaces this string.
eg.: &#8220;&lt;CATEG&gt;-<a class="reference external" href="mailto:email&#37;&#52;&#48;cern&#46;ch">email<span>&#64;</span>cern<span>&#46;</span>ch</a>&#8220;</p>
</div></blockquote>
<p>categformatDAM</p>
<blockquote>
<div><p>contains a regular expression used to compute the category of the document given the reference of the
document.
eg.: if [categformatAFP]=&#8221;TEST-&lt;CATEG&gt;-.*&#8221; and the reference of the document is
&#8220;TEST-CATEGORY1-2001-001&#8221;, then the computed category equals &#8220;CATEGORY1&#8221;</p>
</div></blockquote>
</div></blockquote>
<p>Test_Status
description</p>
<blockquote>
<div><p>This function checks whether the considered document has been requested for approval and is still waiting
for approval. It also checks whether the password stored in file &#8220;password&#8221; of the submission directory
corresponds to the password associated with the document..</p>
</div></blockquote>
<p>parameters</p>
<blockquote>
<div><p>none</p>
</div></blockquote>
<p>Update_Approval_DB
description</p>
<blockquote>
<div><p>This function updates the approval database when a document has just been approved or rejected. It uses
the [categformatDAM] parameter to compute the category of the document.
Must be called after the Get_Report_Number function.</p>
</div></blockquote>
<p>parameters</p>
<blockquote>
<div><p>categformatDAM</p>
<blockquote>
<div><p>It contains the regular expression which allows the retrieval of the category from the reference number.
Eg: if [categformatDAM]=&#8221;TEST-&lt;CATEG&gt;-.*&#8221; and the reference is &#8220;TEST-CATEG1-2001-001&#8221; then the
category will be recognized as &#8220;CATEG1&#8221;.</p>
</div></blockquote>
</div></blockquote>
<p>Upload_Files
description</p>
<blockquote>
<div><p>This function displays the list of already transfered files (main and additional ones), and also outputs an html
form for uploading other files (pictures or fulltexts).</p>
</div></blockquote>
<p>parameters</p>
<blockquote>
<div><p>maxsize</p>
<blockquote>
<div><p>Maximum allowed size for the transfered files (size in bits)</p>
</div></blockquote>
<p>minsize</p>
<blockquote>
<div><p>Minimum allowed size for the transfered files (size in bits)</p>
</div></blockquote>
<p>iconsize</p>
<blockquote>
<div><p>In case the transfered files are pictures (jpg, gif or pdf), the function will automatically try to create icons from them.
This parameter indicates the size in pixel of the created icon.</p>
</div></blockquote>
<p>type</p>
<blockquote>
<div><p>This can be one of &#8220;fulltext&#8221; or &#8220;picture&#8221;. If the type is set to &#8220;picture&#8221; then the function will try to create icons
(uses the ImageMagick&#8217;s &#8220;convert&#8221; tool)</p>
</div></blockquote>
</div></blockquote>
<p>See also:</p>
<blockquote>
<div><p>create a new function
delete a function
edit a function</p>
</div></blockquote>
</div></blockquote>
<p>Protection and Restriction</p>
<blockquote>
<div><p>Description:</p>
<blockquote>
<div><blockquote>
<div><p>In webSubmit, you can restrict the use of some actions on a given</p>
</div></blockquote>
<p>document type to a list of users. You can use the webAccess
manager for this.</p>
<blockquote>
<div><p>Let&#8217;s say you want to restrict the submission of new TEXT documents</p>
</div></blockquote>
<p>to a given user. You should then create a role in webAccess which will authorize the action &#8220;submit&#8221; over doctype
&#8220;TEXT&#8221; and act &#8220;SBI&#8221; (Submit new record). You can call this role &#8220;submitter_TEXT_SBI&#8221; for example.
Then link the role to the proper users.</p>
<blockquote>
<div><p>Another example: if you wish to authorize a user to Modify the</p>
</div></blockquote>
<p>bibliographic data of PICT documents, you have to create a role which authorize the action &#8220;submit&#8221; over doctype
&#8220;PICT&#8221; and act &#8220;MBI&#8221;. This role can be called &#8220;submitter_PICT_MBI&#8221; or whatever you want.</p>
<blockquote>
<div><p>If no role is defined for a given action and a given document type,</p>
</div></blockquote>
<p>then all users will be allowed to use it.</p>
</div></blockquote>
</div></blockquote>
<p>Submission Catalogue Organisation</p>
<blockquote>
<div><p>What is it?</p>
<blockquote>
<div><p>This feature allows you to organise the way webSubmit main page
will look like. You will be able to group document types inside catalogues and order the catalogues the way you
wish.</p>
</div></blockquote>
<p>How to get there?</p>
<blockquote>
<div><p>Click on the &#8220;Organisation&#8221; link in the websubmit admin right menu.</p>
</div></blockquote>
<p>How to do this?</p>
<blockquote>
<div><p>Once on the &#8220;Edit Catalogues page&#8221;, you will find the currently
defined organisation chart in the middle of the page. To the right, one form allows you to create a new catalogue
(&#8220;Add a Catalogue&#8221;) and one to add a document type to an existing catalogue (&#8220;Add a document type&#8221;).</p>
<blockquote>
<div><p>To add a catalogue: Enter the name of your new catalogue in the
&#8220;Catalogue Name&#8221; free text field then choose to which existing catalogue this one will be attached to. If you
attach the new one to an already existing catalogue, you can create a sub-catalogue. To actually create it,
click on &#8220;ADD&#8221;.
To add a document type to a catalogue: Choose in the list of existing
&#8220;Document type names&#8221; the one you want to add to the chart. Then choose to which catalogue the document
type will be associated. Click on &#8220;ADD&#8221; to finalise this action.
To withdraw a document type or a catalogue from the chart: Click on the
red cross next to the item you want to withdraw. If you withdraw a catalogue all document types attached to
it will be withdrawn also (of course the actual document types in webSubmit won&#8217;t be destroyed!).
To move a document type or a catalogue in the chart: Use the small up
and down arrows next to the document type/catalogue title.</p>
</div></blockquote>
</div></blockquote>
<p>See also:</p>
<blockquote>
<div><p>Create a New Document Type
document types</p>
</div></blockquote>
</div></blockquote>
<p>BibConvert</p>
<blockquote>
<div><p>What is it?</p>
<blockquote>
<div><blockquote>
<div><p>WebSubmit stores the data gathered during a submission in a</p>
</div></blockquote>
<dl class="docutils">
<dt>directory. In this directory each file corresponds to a field saved during the submission.</dt>
<dd><p class="first last">BibConvert is used to create a formatted file which will be easy to</p>
</dd>
<dt>upload in the bibliographical database from this directory.</dt>
<dd><p class="first last">This BibConvert program is called from the</p>
</dd>
</dl>
<p>Make_Record and
Make_Modify_Record functions
from the end script system of webSubmit.</p>
<blockquote>
<div><p>The BibConvert configuration files used by webSubmit are in the</p>
</div></blockquote>
<dl class="docutils">
<dt>/bibconvert/config directory.</dt>
<dd><p class="first last">For more info about bibconvert, please see the dedicated</p>
</dd>
</dl>
<p>guide.</p>
</div></blockquote>
</div></blockquote>
<p>FAQ</p>
<blockquote>
<div><blockquote>
<div><p>Q1. I&#8217;d like to be warned each time there is an error, or an important</p>
</div></blockquote>
<p>action is made through the manager. Is this possible?</p>
<blockquote>
<div><p>Q2. Where are all the files stored in this system?</p>
<p>Q3. How is the documents archive organised?</p>
<p>Q1. I&#8217;d like to be warned each time there is an error, or an important</p>
</div></blockquote>
<p>action is made through the manager. Is this possible?</p>
<blockquote>
<div><blockquote>
<div><p>Yes, it is. Edit the invenio-local.conf file, the &#8220;CFG_SITE_ADMIN_EMAIL&#8221; definition and set it to your email
address. You will then receive all the warning emails issued by the manager.</p>
</div></blockquote>
<p>Q2. Where are all the files stored in this system?</p>
<blockquote>
<div><p>the counter files are here: /opt/invenio/var/data/submit/counters. There are used by the
Report_Number_Generation
function.
all running and completed submissions are stored here: /opt/invenio/var/data/submit/storage.
all the document files attached to records are stored here: /opt/invenio/var/data/files.
all python functions used by webSubmit are stored here: /opt/invenio/lib/python/invenio/websubmit_functions</p>
</div></blockquote>
<p>Q3. How is the documents archive organised?</p>
<blockquote>
<div><p>First of all, the documents files attached to records are stored here: /opt/invenio/var/data/files.
The Upload_Files webSubmit function is used
to link a document with a record.
All documents get an id from the system and are stored in the &#8220;bibdoc&#8221; table in the database. The link between a
document and a record is stored using the &#8220;bibdoc_bibrec&#8221; table.
The document id is used to determine where the files are stored. For example the files of document #14 will be
stored here: /opt/invenio/var/data/files/g0/14
The subdirectory g0 is used to split the documents accross the filesystem.  The CFG_FILE_DIR_SIZE variable from
invenio.conf determines how many documents will be stored under one subdirectory.
Several files may be stored under the same document directory: they are the different formats and versions of the
same document. Versions are indicated by a string of the form &#8221;;1.0&#8221; concatenated to the name of the file.
Please see the HOWTO Manage Fulltext Files for more information on the administrative command line tools available to manipulate fulltext files.</p>
</div></blockquote>
</div></blockquote>
<p>See also:</p>
<blockquote>
<div><p>notes</p>
</div></blockquote>
</div></blockquote>
</div></blockquote>
</li>
</ul>
</div>
</div>
</div>


          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../tools/index.html" class="btn btn-neutral float-right" title="Guide for tool.tind.io"/>Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="create-collection.html" class="btn btn-neutral" title="Creation of Collections"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2014, Kenneth Hole.
    </p>
  </div>

  <a href="https://github.com/snide/sphinx_rtd_theme">Sphinx theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'1.0.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>