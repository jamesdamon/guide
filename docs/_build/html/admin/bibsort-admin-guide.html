

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>BibSort Admin Guide &mdash; tind-doc 1.0.0 documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  
    <link rel="top" title="tind-doc 1.0.0 documentation" href="../index.html"/>
        <link rel="up" title="Guide for System Administrators" href="index.html"/>
        <link rel="next" title="BibSword client Admin Guide" href="bibsword-client-admin-guide.html"/>
        <link rel="prev" title="BibSched Admin Guide" href="bibsched-admin-guide.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        <a href="../index.html" class="fa fa-home"> tind-doc</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
        
            <ul>
<li class="toctree-l1"><a class="reference internal" href="../librarian/index.html">Guide for Librarians</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../librarian/create-collection.html">Create Collections</a></li>
<li class="toctree-l2"><a class="reference internal" href="../librarian/export-xml.html">Export data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../librarian/restrict-documents.html">Make documents restricted</a></li>
</ul>
</li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Guide for System Administrators</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="bibauthority-admin-guide.html">BibAuthority Admin Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="bibcheck-admin-guide.html">BibCheck Admin Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="bibcirculation-admin-guide.html">BibCirculation Admin Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="bibclassify-admin-guide.html">BibClassify Admin Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="bibconvert-admin-guide.html">BibConvert Admin Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="bibedit-admin-guide.html">BibEdit Admin Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="bibexport-admin-guide.html">BibExport Admin Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="bibformat-admin-guide.html">BibFormat Admin Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="bibindex-admin-guide.html">BibIndex Admin Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="bibknowledge-admin-guide.html">BibKnowledge Admin Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="bibmatch-admin-guide.html">BibMatch Admin Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="bibrank-admin-guide.html">BibRank Admin Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="bibsched-admin-guide.html">BibSched Admin Guide</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="">BibSort Admin Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="bibsword-client-admin-guide.html">BibSword client Admin Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="bibupload-admin-guide.html">BibUpload Admin Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="docextract-admin-guide.html">DocExtract Admin Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="elmsubmit-admin-guide.html">ElmSubmit Admin Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="oaiharvest-admin-guide.html">OAIHarvest Admin Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="oairepository-admin-guide.html">OAIRepository Admin Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="publiline-admin-guide.html">Publiline Admin Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="webcomment-admin-guide.html">WebComment Admin Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="webjournal-admin-guide.html">WebJournal Admin Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="webjournal-editor-guide.html">WebJournal Editor Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="webmessage-admin-guide.html">WebMessage Admin Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="websearch-admin-guide.html">WebSearch Admin Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="websession-admin-guide.html">WebSession Admin Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="webstat-admin-guide.html">WebStat Admin Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="webstyle-admin-guide.html">WebStyle Admin Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="websubmit-admin-guide.html">WebSubmit Admin Guide</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tools/index.html">Guide for tools.tind.io</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../tools/xml-manipulation.html">XML Manipulation</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../doc/index.html">Documentation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../doc/intro.html">MARC intro</a></li>
<li class="toctree-l2"><a class="reference internal" href="../doc/docguide.html">Site template</a></li>
<li class="toctree-l2"><a class="reference internal" href="../doc/use-of-marc.html">MARC Fields</a></li>
</ul>
</li>
</ul>

        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">tind-doc</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
          <li><a href="index.html">Guide for System Administrators</a> &raquo;</li>
      
    <li>BibSort Admin Guide</li>
      <li class="wy-breadcrumbs-aside">
        
          <a href="../_sources/admin/bibsort-admin-guide.txt" rel="nofollow"> View page source</a>
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            
  <div class="section" id="bibsort-admin-guide">
<span id="id1"></span><h1>BibSort Admin Guide<a class="headerlink" href="#bibsort-admin-guide" title="Permalink to this headline">¶</a></h1>
<div class="section" id="overview">
<h2>1. Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>BibSort main goal is to make the sorting of search results faster. It does this by creating
several sorting buckets (that hold recids) that are then loaded by the search_engine and cached.</p>
<p>BibSort module is active if the search_engine is using the sorting buckets to fast sort the
search results. BibSort module can be deactivated by setting the <tt class="docutils literal"><span class="pre">CFG_BIBSORT_BUCKETS=0</span></tt> in
the <tt class="docutils literal"><span class="pre">invenio.conf</span></tt> file. Also, if <tt class="docutils literal"><span class="pre">bsrMETHOD</span></tt> table does not contain any data,
it also means that the BibSort module is not active. The search engine will look into the
BibSort data structures to see if the method that was requested to sort the search results
exists or not. If it does not exist, then the old style sorting function (using bibxxx tables)
will be used.</p>
</div>
<div class="section" id="define-sorting-options">
<h2>2. Define Sorting Options<a class="headerlink" href="#define-sorting-options" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id2">
<h3>2.1 Define Sorting Options<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<p>The different sort options that can be chosen are the logical fields defined in BibIndex.
Which sorting methods that should be shown to the user are defined in WebSearch,
collection parameters, point 8 “Modify sort option for collection .. ”.
By default, all sub-collections will have the same settings as the main collection. To change from default
settings, add a new sorting option for the specific collections you would like to change.</p>
</div>
<div class="section" id="translate-the-sorting-options-for-multilingual-sides">
<h3>2.2 Translate the Sorting Options for Multilingual Sides<a class="headerlink" href="#translate-the-sorting-options-for-multilingual-sides" title="Permalink to this headline">¶</a></h3>
<p>Translation of the name is done for each specific logical field in BibIndex
(manage logical fields).</p>
</div>
</div>
<div class="section" id="configure-bibsort">
<h2>3. Configure BibSort<a class="headerlink" href="#configure-bibsort" title="Permalink to this headline">¶</a></h2>
<div class="section" id="introduction">
<h3>3.1 Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h3>
<p>When the user choose a sorting option, for example “title”, the arument “title” will
be added to the url. If no sorting method is defined in BibSort, sorting will still be enabled and executed
by live SQL queries, hence slower than with BibSort.</p>
<p>To enable BibSort for the specific sorting option, the argument need to be equal to the name in
BibSort. Then it will execute the task according to the definition/washer.</p>
</div>
<div class="section" id="configure">
<h3>3.1 Configure<a class="headerlink" href="#configure" title="Permalink to this headline">¶</a></h3>
<p>A new sorting method are added via a configuration file. The location of this file is:
<tt class="docutils literal"><span class="pre">CFG_ETCDIR/bibsort/bibsort.cfg</span></tt>
Each sorting method has a section in this config file, that looks like this:</p>
<div class="highlight-python"><div class="highlight"><pre>[sort_field_1]
name = title
washer = sort_alphanumerically_remove_leading_articles
definition = FIELD: title
</pre></div>
</div>
<p>Each section of the file corresponds to a method:
- The name property holds the name of the sorting method, that should be unique.
- The washer property holds the name of the function that will process the values of the records, for this method, before they get sorted (in this case, it will remove the leading articles). This functions are implemented in bibsort_washer.py.
One can also set the washer to &#8216;NOOP&#8217; which will mean that no washer should be applied to the data before the sorting.
Bibsort supports string collation. There is the possibility of selecting a specific language for this, by adding at the end of the washer &#8216;:ln&#8217;, where &#8216;ln&#8217; is the language according to which the string comparison should be done.
Ex: &#8220;washer = sort_alphanumerically_remove_leading_articles:fr&#8221; means that the string comparison would be done using the French rules.
- The definition property holds the name of the place from where the data should be taken for this sorting method. There are several options for defining this property:</p>
<blockquote>
<div><ul class="simple">
<li>definition = RNK: method_name means that the data should be taken from the rnkMETHODDATA table, based on the method_name (the method_name should correspond to a method in rnkMETHOD table)</li>
<li>definition = MARC: marc1,marc2,marc3.. means that BibSort will sequentially look in all the MARC fields (bibxxx tables) and retrieve the data (the order of the MARC fields is important, since for a given record, BibSort will keep the value from the first MARC field that has data).</li>
<li>definition = FIELD: foo is similar with the above option, but for cases were we already have logical fields defined in Invenio, BibSort can look into them in order to retrieve the list of MARC fields that need to be queried.</li>
</ul>
</div></blockquote>
<p>For adding a new sorting method, one needs to add a new section to the <tt class="docutils literal"><span class="pre">bibsort.cfg</span></tt> file. Once this is done, the config file needs to be loaded into the database:</p>
<p><tt class="docutils literal"><span class="pre">$</span> <span class="pre">./bibsort</span> <span class="pre">--load-config</span></tt>
Similar, for deleting a method, one needs to remove the corresponding section from the bibsort.cfg file, and load the config into the database.
To dump the configuration from the database into a file:
<tt class="docutils literal"><span class="pre">$</span> <span class="pre">./bibsort</span> <span class="pre">--dump-config</span></tt></p>
<p>NOTE: It is necessary to run rebalance (-R) before sorting/updating (-S), after changing
configuration.</p>
</div>
</div>
<div class="section" id="running-bibsort">
<h2>3. Running BibSort<a class="headerlink" href="#running-bibsort" title="Permalink to this headline">¶</a></h2>
<p>There are several command line instructions that can be used in order to update the BibSort data. For each instruction, one can define the methods and the records that the command should run on, like this:</p>
<p><tt class="docutils literal"><span class="pre">$</span> <span class="pre">./bibsort</span> <span class="pre">--methods=method1,method2</span> <span class="pre">--recids=4,7-17,23,1</span></tt>
If these options will be let empty it will mean that the bibsort operations will run on all the defined methods, and either on all the records existing in the database, or on the all updated records (depending on the operation, see 3.1 and 3.2).</p>
<div class="section" id="rebalancing">
<h3>3.1 Rebalancing<a class="headerlink" href="#rebalancing" title="Permalink to this headline">¶</a></h3>
<p>Rebalancing is the operation that will redo from scratch the sorting and recreate the sorting buckets. This should be performed once at the beginning and then maybe once per day, to be sure that the database is in complete sync with the BibSort data structures, and also, to be sure that the buckets are balanced (Imagine a big upload of new records, that will have the same publication year. All these records will be added to the same bucket for the &#8216;publication date&#8217; method, making it much bigger then the others, and slower to perform any data calculations on it, including intersecting with the search engine output). If you have a clear idea of how the data is changing during one day, you can set up the rebalancing only for several methods, that contain data that is frequently updated.</p>
<p><tt class="docutils literal"><span class="pre">$</span> <span class="pre">./bibsort</span> <span class="pre">-B</span> <span class="pre">[--methods=method1,method2]</span></tt></p>
</div>
<div class="section" id="inserting-updating-deleting-records-in-bibsort">
<h3>3.2. Inserting/Updating/Deleting records in BibSort<a class="headerlink" href="#inserting-updating-deleting-records-in-bibsort" title="Permalink to this headline">¶</a></h3>
<p>Inserting/Updating/Deleting records in BibSort is done via the update-sorting operation. Theoretically, this operation should run at short intervals, and for the benefit of the user it would be good to run after BibIndex, so that the updates can be viewed as soon as possible. If no methods are defined it will run for all the methods defined in bibsort.cfg. But, if you have a good overview of the nature of the changes in the data during a period of time, the update-sorting can run more frequently for some methods (like sort by year or sort by title) or less frequently (like sort by most cited, since the citation dictionaries are not updated so frequently). Defining the recids, will result in the update-sorting to run only on those records. If no records are defined bibsort will grab all the modified records since its last run. Since for ranking methods it will anyway grab all the data, update-sorting for a ranking method is basically a rebalancing.</p>
<p><tt class="docutils literal"><span class="pre">$</span> <span class="pre">./bibsort</span> <span class="pre">-S</span> <span class="pre">[--methods=method1,method2]</span> <span class="pre">[--recids=4,7-17,23,1]</span></tt></p>
</div>
</div>
<div class="section" id="impact-on-the-sorted-search-results">
<h2>4. Impact on the sorted search results<a class="headerlink" href="#impact-on-the-sorted-search-results" title="Permalink to this headline">¶</a></h2>
<p>Using the BibSort functionality will have the following impact on the &#8216;Sort by&#8217; functionality of Invenio:</p>
<p>Sorting will no longer need to be limited to CFG_WEBSEARCH_NB_RECORDS_TO_SORT currently set to 200.
Not all the search results will be sorted, but only those up to jrec, so only up to those &#8216;seen&#8217; by the user. This means that using of=id to retrieve the list of recids will not give the full list of recids in case these also need to be sorted.
If in the search results there are records that have no value for the selected sorting method, they will be added at the end, in the order of their insertion date. This records might have just been inserted, this is why it would be important to keep them in the sorted output.</p>
</div>
</div>


          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="bibsword-client-admin-guide.html" class="btn btn-neutral float-right" title="BibSword client Admin Guide"/>Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="bibsched-admin-guide.html" class="btn btn-neutral" title="BibSched Admin Guide"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2014, Kenneth Hole.
    </p>
  </div>

  <a href="https://github.com/snide/sphinx_rtd_theme">Sphinx theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'1.0.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>